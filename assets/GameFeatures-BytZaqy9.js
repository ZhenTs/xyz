import{d as me,c as f,o as g,a as e,e as ie,u as le,r as D,A as B,g as re,G as Y,F as oe,n as de,p as j,t as C,D as Se,l as K,i as ue,f as Ie,H as xe,m as ne,h as $,w as V,j as G,k as ye,I as Ce,J as he,K as be,L as Me,v as De}from"./index-B2ntl-FI.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as ke}from"./Settings-C_A4IUmv.js";import{C as Be}from"./CheckmarkCircle-B_50qmqf.js";import{R as Ue}from"./Refresh-hxtgiIzy.js";import{_ as We}from"./xiaoyugan-Dwisk7G8.js";const Ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=e("path",{d:"M480 128a64 64 0 0 0-64-64h-16V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 368 48v16H144V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 112 48v16H96a64 64 0 0 0-64 64v12a4 4 0 0 0 4 4h440a4 4 0 0 0 4-4z",fill:"currentColor"},null,-1),Re=e("path",{d:"M32 416a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V179a3 3 0 0 0-3-3H35a3 3 0 0 0-3 3zm344-208a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24z",fill:"currentColor"},null,-1),ze=[Oe,Re],He=me({name:"Calendar",render:function(n,c){return g(),f("svg",Ee,ze)}}),Ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=e("path",{d:"M428 224H288a48 48 0 0 1-48-48V36a4 4 0 0 0-4-4h-92a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h224a64 64 0 0 0 64-64V228a4 4 0 0 0-4-4zm-92 160H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32zm0-80H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),Pe=e("path",{d:"M419.22 188.59L275.41 44.78a2 2 0 0 0-3.41 1.41V176a16 16 0 0 0 16 16h129.81a2 2 0 0 0 1.41-3.41z",fill:"currentColor"},null,-1),Le=[Ae,Pe],Ve=me({name:"DocumentText",render:function(n,c){return g(),f("svg",Ne,Le)}}),Ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},je=e("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),qe=[je],Je=me({name:"EllipseOutline",render:function(n,c){return g(),f("svg",Ge,qe)}}),Qe="/icons/173746572831736.png",Ke="/icons/174061875626614.png",Xe="/icons/1733492491706152.png",we="/icons/1733492491706148.png",Ye="/icons/1736425783912140.png",Ze="/icons/Ob7pyorzmHiJcbab2c25af264d0758b527bc1b61cc3b.png",Fe={class:"team-status-card"},et={class:"card-header"},tt={class:"team-selector"},st=["disabled","onClick"],at=["disabled"],nt={class:"card-content"},ot={class:"team-display"},it={class:"current-team-info"},lt={class:"team-number"},rt={class:"heroes-container"},ct={key:0,class:"heroes-inline"},ut={class:"hero-circle"},dt=["src","alt"],mt={key:1,class:"hero-placeholder"},pt={class:"hero-name"},gt={key:1,class:"empty-team"},vt={key:2,class:"empty-team"},ft=me({__name:"TeamStatus",setup(te){const n={101:{name:"司马懿",type:"魏国"},102:{name:"郭嘉",type:"魏国"},103:{name:"关羽",type:"蜀国"},104:{name:"诸葛亮",type:"蜀国"},105:{name:"周瑜",type:"吴国"},106:{name:"太史慈",type:"吴国"},107:{name:"吕布",type:"群雄"},108:{name:"华佗",type:"群雄"},109:{name:"甄姬",type:"魏国"},110:{name:"黄月英",type:"蜀国"},111:{name:"孙策",type:"吴国"},112:{name:"贾诩",type:"群雄"},113:{name:"曹仁",type:"魏国"},114:{name:"姜维",type:"蜀国"},115:{name:"孙坚",type:"吴国"},116:{name:"公孙瓒",type:"群雄"},117:{name:"典韦",type:"魏国"},118:{name:"赵云",type:"蜀国"},119:{name:"大乔",type:"吴国"},120:{name:"张角",type:"群雄"},201:{name:"徐晃",type:"魏国"},202:{name:"荀彧",type:"魏国"},203:{name:"典韦",type:"魏国"},204:{name:"张飞",type:"蜀国"},205:{name:"赵云",type:"蜀国"},206:{name:"庞统",type:"蜀国"},207:{name:"鲁肃",type:"吴国"},208:{name:"陆逊",type:"吴国"},209:{name:"甘宁",type:"吴国"},210:{name:"貂蝉",type:"群雄"},211:{name:"董卓",type:"群雄"},212:{name:"张角",type:"群雄"},213:{name:"张辽",type:"魏国"},214:{name:"夏侯惇",type:"魏国"},215:{name:"许褚",type:"魏国"},216:{name:"夏侯渊",type:"魏国"},217:{name:"魏延",type:"蜀国"},218:{name:"黄忠",type:"蜀国"},219:{name:"马超",type:"蜀国"},220:{name:"马岱",type:"蜀国"},221:{name:"吕蒙",type:"吴国"},222:{name:"黄盖",type:"吴国"},223:{name:"蔡文姬",type:"魏国"},224:{name:"小乔",type:"吴国"},225:{name:"袁绍",type:"群雄"},226:{name:"华雄",type:"群雄"},227:{name:"颜良",type:"群雄"},228:{name:"文丑",type:"群雄"},301:{name:"周泰",type:"吴国"},302:{name:"许攸",type:"魏国"},303:{name:"于禁",type:"魏国"},304:{name:"张星彩",type:"蜀国"},305:{name:"关银屏",type:"蜀国"},306:{name:"关平",type:"蜀国"},307:{name:"程普",type:"吴国"},308:{name:"张昭",type:"吴国"},309:{name:"陆绩",type:"吴国"},310:{name:"吕玲绮",type:"群雄"},311:{name:"潘凤",type:"群雄"},312:{name:"邢道荣",type:"群雄"},313:{name:"祝融夫人",type:"群雄"},314:{name:"孟获",type:"群雄"}},c=ie(),l=le(),o=D(!1),x=D(!1),S=D(1),I=D([1,2,3,4]),i=B(()=>c.selectedToken?c.getWebSocketStatus(c.selectedToken.id):"disconnected"),k=B(()=>{var a;return((a=c.gameData)==null?void 0:a.presetTeam)??null});function U(a){var pe;if(!a)return{useTeamId:1,teams:{}};const s=a.presetTeamInfo??a,p=J=>{if(!J||typeof J!="object")return null;if(typeof J.useTeamId=="number")return J.useTeamId;for(const F of Object.keys(J)){const L=p(J[F]);if(L)return L}return null},v=s.useTeamId??((pe=s.presetTeamInfo)==null?void 0:pe.useTeamId)??p(s)??1,h=s.presetTeamInfo??s,M={},P=Object.keys(h||{}).filter(J=>/^\d+$/.test(J));for(const J of P){const F=Number(J),L=h[J];if(!L){M[F]={teamInfo:{}};continue}if(L.teamInfo)M[F]={teamInfo:L.teamInfo};else if(L.heroes){const se={};L.heroes.forEach((ae,r)=>{se[String(r+1)]=ae}),M[F]={teamInfo:se}}else if(typeof L=="object"){const se=Object.values(L).some(ae=>ae&&typeof ae=="object"&&"heroId"in ae);M[F]={teamInfo:se?L:{}}}else M[F]={teamInfo:{}}}return{useTeamId:Number(v)||1,teams:M}}const T=B(()=>U(k.value)),Z=B(()=>{var p;const a=(p=T.value.teams[S.value])==null?void 0:p.teamInfo;if(!a)return[];const s=[];for(const[v,h]of Object.entries(a)){const M=(h==null?void 0:h.heroId)??(h==null?void 0:h.id);if(!M)continue;const P=n[Number(M)];s.push({id:Number(M),name:(P==null?void 0:P.name)??`英雄${M}`,type:(P==null?void 0:P.type)??"",position:Number(v),level:(h==null?void 0:h.level)??1,avatar:h==null?void 0:h.avatar})}return s.sort((v,h)=>v.position-h.position),s}),_=async(a,s,p={},v="",h=8e3)=>{try{return await c.sendMessageWithPromise(a,s,p,h)}catch(M){const P=(M==null?void 0:M.message)??String(M);throw v&&l.error(`${v}失败：${P}`),M}},b=async(a=!1)=>{var p,v;if(!c.selectedToken)return l.warning("请先选择Token"),null;const s=c.selectedToken.id;if(!a){const h=(v=(p=c.gameData)==null?void 0:p.presetTeam)==null?void 0:v.presetTeamInfo;if(h)return h}o.value=!0;try{const h=await _(s,"presetteam_getinfo",{},"获取阵容信息");return c.$patch(M=>{M.gameData={...M.gameData??{},presetTeam:h}}),(h==null?void 0:h.presetTeamInfo)??null}catch(h){return console.error("获取阵容信息失败:",h),null}finally{o.value=!1}},W=()=>{const a=Object.keys(T.value.teams).map(Number).filter(s=>!Number.isNaN(s)).sort((s,p)=>s-p);I.value=a.length?a:[1,2,3,4]},z=()=>{S.value=T.value.useTeamId||1},q=async a=>{if(x.value||o.value)return;if(!c.selectedToken){l.warning("请先选择Token");return}const s=S.value;x.value=!0;try{await _(c.selectedToken.id,"presetteam_saveteam",{teamId:a},`切换到阵容 ${a}`),S.value=a,l.success(`已切换到阵容 ${a}`),await O(!0)}catch{S.value=s}finally{x.value=!1}},O=async(a=!1)=>{await b(a)};return re(async()=>{c.selectedToken&&i.value==="connected"?(await O(!1),W(),z(),k.value||(await O(!0),W(),z())):c.selectedToken?console.log("🛡️ WebSocket未连接，等待连接后自动获取队伍信息"):console.log("🛡️ 没有选中的Token，无法获取队伍信息")}),Y(i,(a,s)=>{console.log(`🛡️ WebSocket状态变化: ${s} -> ${a}`),a==="connected"&&s!=="connected"&&c.selectedToken&&(console.log("🛡️ WebSocket已连接，自动获取队伍信息"),setTimeout(async()=>{await O(!1),W(),z(),k.value||(await O(!0),W(),z())},1e3))}),Y(()=>c.selectedToken,async(a,s)=>{a&&a.id!==(s==null?void 0:s.id)&&(console.log("🛡️ Token已切换，重新获取队伍信息"),c.getWebSocketStatus(a.id)==="connected"&&(await O(!0),W(),z()))}),Y(()=>k.value,()=>{W(),z()},{deep:!0}),(a,s)=>(g(),f("div",Fe,[e("div",et,[s[2]||(s[2]=e("img",{src:Ze,alt:"队伍图标",class:"team-icon"},null,-1)),s[3]||(s[3]=e("div",{class:"team-info"},[e("h3",null,"队伍阵容"),e("p",null,"当前使用的战斗阵容")],-1)),e("div",tt,[(g(!0),f(oe,null,de(I.value,p=>(g(),f("button",{key:p,disabled:o.value||x.value,class:j(["team-button",{active:S.value===p}]),onClick:v=>q(p)},C(p),11,st))),128)),e("button",{class:"refresh-button",disabled:o.value,title:"刷新队伍数据",onClick:s[0]||(s[0]=p=>O(!0))},[...s[1]||(s[1]=[Se('<svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e04fa38a><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-e04fa38a></path><path d="M21 3v5h-5" data-v-e04fa38a></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-e04fa38a></path><path d="M3 21v-5h5" data-v-e04fa38a></path></svg><span class="refresh-text" data-v-e04fa38a>刷新</span>',2)])],8,at)])]),e("div",nt,[e("div",ot,[e("div",it,[s[4]||(s[4]=e("span",{class:"label"},"当前阵容",-1)),e("span",lt,[o.value?(g(),f(oe,{key:1},[K("加载中…")],64)):(g(),f(oe,{key:0},[K("阵容 "+C(S.value),1)],64))])]),e("div",rt,[o.value?ue("",!0):(g(),f("div",ct,[(g(!0),f(oe,null,de(Z.value,p=>{var v;return g(),f("div",{key:p.id||p.name,class:"hero-item"},[e("div",ut,[p.avatar?(g(),f("img",{key:0,src:p.avatar,alt:p.name,class:"hero-avatar"},null,8,dt)):(g(),f("div",mt,C(((v=p.name)==null?void 0:v.substring(0,2))||"?"),1))]),e("span",pt,C(p.name||"未知"),1)])}),128))])),!o.value&&!Z.value.length?(g(),f("div",gt,[...s[5]||(s[5]=[e("p",null,"暂无队伍信息",-1)])])):ue("",!0),o.value?(g(),f("div",vt,[...s[6]||(s[6]=[e("p",null,"正在加载队伍信息…",-1)])])):ue("",!0)])])])]))}}),_t=ce(ft,[["__scopeId","data-v-e04fa38a"]]),yt="/icons/174023274867420.png",ht={class:"daily-task-container"},kt={class:"task-header"},Tt={class:"header-right"},bt={class:"progress-container"},wt=["disabled"],$t={key:0,class:"loading-text"},St={key:1},It={key:2},xt={class:"modal-header"},Ct={class:"settings-content"},Mt={class:"settings-grid"},Dt={class:"setting-item"},Bt={class:"setting-item"},Ut={class:"setting-item"},Wt={class:"setting-switches"},Et={class:"switch-row"},Ot={class:"switch-row"},Rt={class:"switch-row"},zt={class:"switch-row"},Ht={class:"switch-row"},Nt={class:"switch-row"},At={class:"switch-row"},Pt={class:"modal-header"},Lt=["disabled"],Vt={class:"task-list"},Gt={class:"task-item-left"},jt={class:"task-name"},qt={class:"modal-header"},Jt={class:"log-time"},Te=500,Qt={__name:"DailyTaskStatus",setup(te){const n=ie(),c=le(),l=D(!1),o=D(!1),x=D(!1),S=D(!1),I=D(null),i=Ie({arenaFormation:1,bossFormation:1,bossTimes:4,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),k=D([{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品（请设置采购清单）",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}]),U=[1,2,3,4].map(r=>({label:`阵容${r}`,value:r})),T=[0,1,2,3,4].map(r=>({label:`${r}次`,value:r})),Z=B(()=>n.selectedTokenRoleInfo),_=B(()=>{var r,t,y;return((y=(t=(r=Z.value)==null?void 0:r.role)==null?void 0:t.dailyTask)==null?void 0:y.dailyPoint)??0}),b=B(()=>Math.min(_.value,100)),W=B(()=>b.value>=100),z=B(()=>W.value?"#10b981":"#3b82f6"),q=B(()=>n.selectedToken?n.getWebSocketStatus(n.selectedToken.id)==="connected":!1),O=D([]),a=(r,t="info")=>{const y=new Date().toLocaleTimeString();O.value.push({time:y,message:r,type:t}),O.value.length>Te&&O.value.splice(0,O.value.length-Te),Ce(()=>{I.value&&(I.value.scrollTop=I.value.scrollHeight)})},s=r=>{var E,R;if(!((R=(E=r==null?void 0:r.role)==null?void 0:E.dailyTask)!=null&&R.complete)){a("角色信息中无任务完成数据","warning");return}const t=r.role.dailyTask.complete,y=H=>H===-1;a("开始同步任务完成状态..."),a(`服务器返回的任务完成数据: ${JSON.stringify(t)}`);let d=0,N=0;k.value.forEach(H=>{H.completed=!1}),Object.keys(t).forEach(H=>{const u=Number(H),w=k.value.findIndex(ee=>ee.id===u);if(w>=0){const ee=y(t[H]);k.value[w].completed=ee,d++,ee&&N++,a(`任务${u} "${k.value[w].name}": ${ee?"已完成":"未完成"}`,ee?"success":"info")}else a(`服务器返回未知任务ID: ${u} (完成值: ${t[H]})`,"warning")}),a(`任务状态同步完成: ${N}/${d} 已完成`),a(`当前进度: ${_.value}/100`)},p=async()=>{if(!n.selectedToken)throw new Error("没有选中的Token");const r=n.selectedToken.id;a("正在获取角色信息...");try{const t=await n.sendGetRoleInfo(r);return a("角色信息获取成功","success"),t&&s(t),t}catch(t){throw a(`获取角色信息失败: ${t.message}`,"error"),t}},v=async(r,t,y={},d="",N=8e3)=>{try{d&&a(`执行: ${d}`);const E=await n.sendMessageWithPromise(r,t,y,N);return d&&a(`${d} - 成功`,"success"),E}catch(E){throw d&&a(`${d} - 失败: ${E.message}`,"error"),E}},h=r=>{if(!r)return!0;const t=new Date().toDateString(),y=new Date(r).toDateString();return t!==y},M=()=>{const r=[9904,9905,9901,9902,9903,9904,9905],t=new Date().getDay();return r[t]},P=async(r,t,y,d)=>{var N,E,R;try{const H=(E=(N=n.gameData)==null?void 0:N.presetTeam)==null?void 0:E.presetTeamInfo;let u=H==null?void 0:H.useTeamId;if(u)d(`从缓存获取当前阵容: ${u}`);else{d("缓存中无阵容信息，从服务器获取...");const w=await v(r,"presetteam_getinfo",{},"获取阵容信息");u=(R=w==null?void 0:w.presetTeamInfo)==null?void 0:R.useTeamId,d(`从服务器获取当前阵容: ${u}`)}return u===t?(d(`当前已是${y}${t}，无需切换`,"success"),!1):(d(`当前阵容: ${u}, 目标阵容: ${t}，开始切换...`),await v(r,"presetteam_saveteam",{teamId:t},`切换到${y}${t}`),d(`成功切换到${y}${t}`,"success"),!0)}catch(H){d(`阵容检查失败，直接切换: ${H.message}`,"warning");try{return await v(r,"presetteam_saveteam",{teamId:t},`强制切换到${y}${t}`),!0}catch(u){throw d(`强制切换也失败: ${u.message}`,"error"),u}}},pe=async(r,t,y)=>{var fe;const d=n.selectedToken.id,N=r==null?void 0:r.role;if(!N)throw new Error("角色数据不存在");t("开始执行每日任务补差");const E=((fe=N.dailyTask)==null?void 0:fe.complete)??{},R=m=>E[m]===-1,H=N.statistics??{},u=N.statisticsTime??{},w=[];if(R(2)||w.push({name:"分享一次游戏",execute:()=>v(d,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),R(3)||w.push({name:"赠送好友金币",execute:()=>v(d,"friend_batch",{},"赠送好友金币")}),R(4)||(w.push({name:"免费招募",execute:()=>v(d,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),i.payRecruit&&w.push({name:"付费招募",execute:()=>v(d,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!R(6)&&h(u["buy:gold"]))for(let m=0;m<3;m++)w.push({name:`免费点金 ${m+1}/3`,execute:()=>v(d,"system_buygold",{buyNum:1},`免费点金 ${m+1}`)});if(!R(5)&&i.claimHangUp){for(let m=0;m<4;m++)w.push({name:`挂机加钟 ${m+1}/4`,execute:()=>v(d,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${m+1}`)});w.push({name:"领取挂机奖励",execute:()=>v(d,"system_claimhangupreward",{},"领取挂机奖励")}),w.push({name:"挂机加钟 5/5",execute:()=>v(d,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(!R(7)&&i.openBox&&w.push({name:"开启木质宝箱",execute:()=>v(d,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),!R(14)&&i.claimBottle&&w.push({name:"领取盐罐奖励",execute:()=>v(d,"bottlehelper_claim",{},"领取盐罐奖励")}),!R(13)&&i.arenaEnable&&w.push({name:"竞技场战斗",execute:async()=>{var m,X;t("开始竞技场战斗流程"),await P(d,i.arenaFormation,"竞技场阵容",t),await v(d,"arena_startarea",{},"开始竞技场");for(let Q=1;Q<=3;Q++){t(`竞技场战斗 ${Q}/3`);const A=await v(d,"arena_getareatarget",{refresh:!1},`获取竞技场目标${Q}`),_e=(X=(m=A==null?void 0:A.roleList)==null?void 0:m[0])==null?void 0:X.roleId;_e?await v(d,"fight_startareaarena",{targetId:_e},`竞技场战斗${Q}`,1e4):t(`竞技场战斗${Q} - 未找到目标`,"warning"),await new Promise($e=>setTimeout($e,1e3))}}}),i.bossTimes>0){const m=H["legion:boss"]??0,X=Math.max(i.bossTimes-m,0);if(X>0){w.push({name:"军团BOSS阵容检查",execute:()=>P(d,i.bossFormation,"BOSS阵容",t)});for(let A=0;A<X;A++)w.push({name:`军团BOSS ${A+1}/${X}`,execute:()=>v(d,"fight_startlegionboss",{},`军团BOSS ${A+1}`,12e3)})}const Q=M();X===0&&w.push({name:"每日BOSS阵容检查",execute:()=>P(d,i.bossFormation,"BOSS阵容",t)});for(let A=0;A<3;A++)w.push({name:`每日BOSS ${A+1}/3`,execute:()=>v(d,"fight_startboss",{bossId:Q},`每日BOSS ${A+1}`,12e3)})}const ee=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部签到",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取免费礼包",cmd:"card_claimreward"},{name:"领取永久卡礼包",cmd:"card_claimreward",params:{cardId:4003}}];if(i.claimEmail&&ee.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),ee.forEach(m=>{w.push({name:m.name,execute:()=>v(d,m.cmd,m.params||{},m.name)})}),h(u["artifact:normal:lottery:time"]))for(let m=0;m<3;m++)w.push({name:`免费钓鱼 ${m+1}/3`,execute:()=>v(d,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${m+1}`)});const ge=["魏国","蜀国","吴国","群雄"];for(let m=1;m<=4;m++)h(u[`genie:daily:free:${m}`])&&w.push({name:`${ge[m-1]}灯神免费扫荡`,execute:()=>v(d,"genie_sweep",{genieId:m},`${ge[m-1]}灯神免费扫荡`)});for(let m=0;m<3;m++)w.push({name:`领取免费扫荡卷 ${m+1}/3`,execute:()=>v(d,"genie_buysweep",{},`领取免费扫荡卷 ${m+1}`)});!R(12)&&i.blackMarketPurchase&&w.push({name:"黑市购买1次物品",execute:()=>v(d,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let m=1;m<=10;m++)w.push({name:`领取任务奖励${m}`,execute:()=>v(d,"task_claimdailypoint",{taskId:m},`领取任务奖励${m}`,5e3)});w.push({name:"领取日常任务奖励",execute:()=>v(d,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>v(d,"task_claimweekreward",{},"领取周常任务奖励")});const ve=w.length;t(`共有 ${ve} 个任务待执行`);for(let m=0;m<w.length;m++){const X=w[m];try{await X.execute();const Q=Math.floor((m+1)/ve*100);y&&y(d,Q),await new Promise(A=>setTimeout(A,500))}catch(Q){t(`任务执行失败: ${X.name} - ${Q.message}`,"error")}}y&&y(d,100),t("所有任务执行完成","success"),await new Promise(m=>setTimeout(m,2e3)),await p()},J=async()=>{var r;if(!n.selectedToken||S.value){c.warning("没有选中Token或正在执行中");return}if(!q.value){c.error("WebSocket连接未建立，请检查连接状态");return}S.value=!0,x.value=!0,O.value=[];try{a("=== 开始执行一键补差任务 ===");const t=await p();if(!(t!=null&&t.role))throw new Error("获取角色信息失败或数据异常");a(`当前每日任务进度: ${((r=t.role.dailyTask)==null?void 0:r.dailyPoint)||0}/100`),a("第二步: 开始执行每日任务..."),await pe(t,a,(y,d)=>{a(`任务进度: ${d}%`)}),a("=== 任务执行完成 ===","success"),c.success("每日任务补差执行完成"),setTimeout(async()=>{try{await p(),a("最终角色信息刷新完成","success")}catch(y){a(`最终刷新失败: ${y.message}`,"warning")}},3e3)}catch(t){a(`任务执行失败: ${t.message}`,"error"),console.error("详细错误信息:",t),c.error(`任务执行失败: ${t.message}`)}finally{S.value=!1}},F=async()=>{if(!q.value){c.warning("WebSocket未连接，无法刷新任务状态");return}try{a("手动刷新任务状态..."),await p(),c.success("任务状态刷新成功")}catch(r){a(`刷新失败: ${r.message}`,"error"),c.error(`刷新失败: ${r.message}`)}},L=()=>n.selectedToken?{roleId:n.selectedToken.id}:null,se=r=>{try{const t=localStorage.getItem(`daily-settings:${r}`);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load settings:",t),null}},ae=(r,t)=>{try{localStorage.setItem(`daily-settings:${r}`,JSON.stringify(t))}catch(y){console.error("Failed to save settings:",y)}};return Y(i,r=>{const t=L();t&&ae(t.roleId,r)},{deep:!0}),Y(()=>n.selectedToken,async(r,t)=>{if(r&&r!==t){a(`切换到Token: ${r.name}`);const y=se(r.id);if(y&&Object.assign(i,y),q.value)try{await p()}catch(d){console.warn("切换token后获取角色信息失败:",d.message)}}},{immediate:!0}),Y(()=>n.selectedTokenRoleInfo,r=>{var t,y;(y=(t=r==null?void 0:r.role)==null?void 0:t.dailyTask)!=null&&y.complete&&(a("角色信息更新，同步任务状态"),s(r))},{immediate:!0,deep:!0}),re(async()=>{if(a("组件初始化完成"),n.selectedToken&&q.value)try{await p()}catch(t){console.warn("初始化时获取角色信息失败:",t.message)}const r=L();if(r){const t=se(r.roleId);t&&Object.assign(i,t)}}),xe(()=>{a("组件即将卸载")}),(r,t)=>{const y=ne("n-icon"),d=ne("n-progress"),N=ne("n-select"),E=ne("n-switch"),R=ne("n-modal"),H=ne("n-tag");return g(),f("div",ht,[e("div",kt,[t[16]||(t[16]=e("div",{class:"header-left"},[e("img",{src:yt,alt:"每日任务",class:"task-icon"}),e("div",{class:"title-container"},[e("h3",null,"每日任务"),e("p",null,"当前进度")])],-1)),e("div",Tt,[e("div",{class:j(["status-indicator",{completed:W.value}]),onClick:t[0]||(t[0]=u=>o.value=!0)},[e("div",{class:j(["status-dot",{completed:W.value}])},null,2),t[15]||(t[15]=e("span",null,"任务详情",-1))],2),e("button",{class:"settings-button",onClick:t[1]||(t[1]=u=>l.value=!0)},[$(y,null,{default:V(()=>[$(G(ke))]),_:1})])])]),e("div",bt,[$(d,{type:"line",percentage:b.value,height:8,"border-radius":4,color:z.value,"rail-color":"#f3f4f6"},null,8,["percentage","color"])]),t[32]||(t[32]=e("div",{class:"info-container"}," 右上角小齿轮有惊喜 ",-1)),e("button",{class:"execute-button",disabled:S.value||!q.value,onClick:J},[S.value?(g(),f("span",$t,[...t[17]||(t[17]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 执行中... ",-1)])])):q.value?(g(),f("span",It,"一键补差")):(g(),f("span",St,"WebSocket未连接"))],8,wt),$(R,{show:l.value,"onUpdate:show":t[12]||(t[12]=u=>l.value=u),preset:"card",title:"任务设置",style:{width:"400px"}},{header:V(()=>[e("div",xt,[$(y,null,{default:V(()=>[$(G(ke))]),_:1}),t[18]||(t[18]=e("span",null,"任务设置",-1))])]),default:V(()=>[e("div",Ct,[e("div",Mt,[e("div",Dt,[t[19]||(t[19]=e("label",{class:"setting-label"},"竞技场阵容",-1)),$(N,{value:i.arenaFormation,"onUpdate:value":t[2]||(t[2]=u=>i.arenaFormation=u),options:G(U),size:"small"},null,8,["value","options"])]),e("div",Bt,[t[20]||(t[20]=e("label",{class:"setting-label"},"BOSS阵容",-1)),$(N,{value:i.bossFormation,"onUpdate:value":t[3]||(t[3]=u=>i.bossFormation=u),options:G(U),size:"small"},null,8,["value","options"])]),e("div",Ut,[t[21]||(t[21]=e("label",{class:"setting-label"},"BOSS次数",-1)),$(N,{value:i.bossTimes,"onUpdate:value":t[4]||(t[4]=u=>i.bossTimes=u),options:G(T),size:"small"},null,8,["value","options"])]),e("div",Wt,[e("div",Et,[t[22]||(t[22]=e("span",{class:"switch-label"},"领罐子",-1)),$(E,{value:i.claimBottle,"onUpdate:value":t[5]||(t[5]=u=>i.claimBottle=u)},null,8,["value"])]),e("div",Ot,[t[23]||(t[23]=e("span",{class:"switch-label"},"领挂机",-1)),$(E,{value:i.claimHangUp,"onUpdate:value":t[6]||(t[6]=u=>i.claimHangUp=u)},null,8,["value"])]),e("div",Rt,[t[24]||(t[24]=e("span",{class:"switch-label"},"竞技场",-1)),$(E,{value:i.arenaEnable,"onUpdate:value":t[7]||(t[7]=u=>i.arenaEnable=u)},null,8,["value"])]),e("div",zt,[t[25]||(t[25]=e("span",{class:"switch-label"},"开宝箱",-1)),$(E,{value:i.openBox,"onUpdate:value":t[8]||(t[8]=u=>i.openBox=u)},null,8,["value"])]),e("div",Ht,[t[26]||(t[26]=e("span",{class:"switch-label"},"领取邮件奖励",-1)),$(E,{value:i.claimEmail,"onUpdate:value":t[9]||(t[9]=u=>i.claimEmail=u)},null,8,["value"])]),e("div",Nt,[t[27]||(t[27]=e("span",{class:"switch-label"},"黑市购买物品",-1)),$(E,{value:i.blackMarketPurchase,"onUpdate:value":t[10]||(t[10]=u=>i.blackMarketPurchase=u)},null,8,["value"])]),e("div",At,[t[28]||(t[28]=e("span",{class:"switch-label"},"付费招募",-1)),$(E,{value:i.payRecruit,"onUpdate:value":t[11]||(t[11]=u=>i.payRecruit=u)},null,8,["value"])])])])])]),_:1},8,["show"]),$(R,{show:o.value,"onUpdate:show":t[13]||(t[13]=u=>o.value=u),preset:"card",title:"每日任务详情",style:{width:"400px"}},{header:V(()=>[e("div",Pt,[$(y,null,{default:V(()=>[$(G(He))]),_:1}),t[30]||(t[30]=e("span",null,"每日任务详情",-1)),e("button",{class:"refresh-button",disabled:S.value,onClick:F},[$(y,null,{default:V(()=>[$(G(Ue))]),_:1}),t[29]||(t[29]=K(" 刷新状态 ",-1))],8,Lt)])]),default:V(()=>[e("div",Vt,[(g(!0),f(oe,null,de(k.value,u=>(g(),f("div",{key:u.id,class:"task-item"},[e("div",Gt,[$(y,{class:j(["task-status-icon",{completed:u.completed}])},{default:V(()=>[u.completed?(g(),ye(G(Be),{key:0})):(g(),ye(G(Je),{key:1}))]),_:2},1032,["class"]),e("span",jt,C(u.name),1)]),$(H,{type:u.completed?"success":"default",size:"small"},{default:V(()=>[K(C(u.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]),_:1},8,["show"]),$(R,{show:x.value,"onUpdate:show":t[14]||(t[14]=u=>x.value=u),preset:"card",title:"任务执行日志",style:{width:"500px"}},{header:V(()=>[e("div",qt,[$(y,null,{default:V(()=>[$(G(Ve))]),_:1}),t[31]||(t[31]=e("span",null,"任务执行日志",-1))])]),default:V(()=>[e("div",{ref_key:"logContainer",ref:I,class:"log-container"},[(g(!0),f(oe,null,de(O.value,u=>(g(),f("div",{key:u.time+u.message,class:"log-item"},[e("span",Jt,C(u.time),1),e("span",{class:j(["log-message",{error:u.type==="error",success:u.type==="success",warning:u.type==="warning"}])},C(u.message),3)]))),128))],512)]),_:1},8,["show"])])}}},Kt=ce(Qt,[["__scopeId","data-v-7e86c1b9"]]),Xt={class:"tower-status-card"},Yt={class:"card-header"},Zt={class:"energy-display"},Ft={class:"energy-count"},es={class:"card-content"},ts={class:"tower-floor"},ss={class:"floor-number"},as={class:"card-actions"},ns=["disabled"],os={__name:"TowerStatus",setup(te){const n=ie(),c=le(),l=D(!1),o=D(null);D(null);const x=B(()=>{var b;return((b=n.gameData)==null?void 0:b.roleInfo)||null}),S=B(()=>{var q,O;const _=(O=(q=x.value)==null?void 0:q.role)==null?void 0:O.tower;if(!_||!_.id&&_.id!==0)return"0 - 0";const b=_.id,W=Math.floor(b/10)+1,z=b%10+1;return`${W} - ${z}`}),I=B(()=>{var W,z;const _=(z=(W=x.value)==null?void 0:W.role)==null?void 0:z.tower;return(_==null?void 0:_.energy)||0}),i=B(()=>{const _=I.value>0,b=!l.value;return _&&b}),k=async()=>{if(!n.selectedToken){c.warning("请先选择Token");return}if(!i.value){c.warning("体力不足或正在爬塔中");return}o.value&&(clearTimeout(o.value),o.value=null),l.value=!0,o.value=setTimeout(()=>{l.value=!1,o.value=null},15e3);try{const _=n.selectedToken.id;await n.sendMessageWithPromise(_,"fight_starttower",{},1e4),c.success("爬塔命令已发送"),await T(),setTimeout(async()=>{await T(),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1},500)}catch(_){c.error("爬塔失败: "+(_.message||"未知错误")),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1}},U=()=>{o.value&&(clearTimeout(o.value),o.value=null),l.value=!1,c.info("爬塔状态已重置")},T=async()=>{if(!n.selectedToken){console.warn("🗼 getTowerInfo: 没有选中的Token");return}try{const _=n.selectedToken.id;if(n.getWebSocketStatus(_)!=="connected")return;const W=n.sendMessage(_,"role_getroleinfo"),z=n.sendMessage(_,"tower_getinfo");!W&&!z&&console.error("🗼 getTowerInfo: 所有请求都失败了")}catch(_){console.error("🗼 getTowerInfo: 获取塔信息失败:",_)}},Z=B(()=>n.selectedToken?n.getWebSocketStatus(n.selectedToken.id):"disconnected");return Y(Z,(_,b)=>{console.log(`🗼 WebSocket状态变化: ${b} -> ${_}`),_==="connected"&&b!=="connected"&&(console.log("🗼 WebSocket已连接，自动获取塔信息"),setTimeout(()=>{T()},1e3))}),Y(()=>n.selectedToken,(_,b)=>{_&&_.id!==(b==null?void 0:b.id)&&(console.log("🗼 Token已切换，获取新的塔信息"),n.getWebSocketStatus(_.id)==="connected"&&T())}),Y(()=>n.gameData.towerResult,(_,b)=>{_&&_.timestamp!==(b==null?void 0:b.timestamp)&&(console.log("🗼 收到新的爬塔结果:",_),_.success?(c.success("咸将塔挑战成功！"),_.autoReward&&setTimeout(()=>{c.success(`自动领取第${_.rewardFloor}层奖励`)},1e3)):c.error("咸将塔挑战失败"),setTimeout(()=>{console.log("🗼 爬塔结果处理完成，重置状态"),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1},2e3))},{deep:!0}),re(()=>{n.selectedToken&&n.getWebSocketClient(n.selectedToken.id),n.selectedToken&&Z.value==="connected"?T():n.selectedToken?console.log("🗼 WebSocket未连接，等待连接后自动获取塔信息"):console.log("🗼 没有选中的Token，无法获取塔信息")}),(_,b)=>(g(),f("div",Xt,[e("div",Yt,[b[1]||(b[1]=e("div",{class:"header-info"},[e("img",{src:we,alt:"爬塔图标",class:"tower-icon"}),e("div",{class:"tower-info"},[e("h3",null,"咸将塔"),e("p",null,"一个不小心就过了")])],-1)),e("div",Zt,[b[0]||(b[0]=e("img",{src:We,alt:"小鱼干",class:"energy-icon"},null,-1)),e("span",Ft,C(I.value),1)])]),e("div",es,[e("div",ts,[b[2]||(b[2]=e("span",{class:"label"},"当前层数",-1)),e("span",ss,C(S.value),1)])]),e("div",as,[e("button",{class:j(["climb-button",{active:i.value,disabled:!i.value}]),disabled:!i.value,onClick:k},C(l.value.value?"爬塔中...":"开始爬塔"),11,ns),l.value.value?(g(),f("button",{key:0,class:"reset-button",onClick:U}," 重置状态 ")):ue("",!0)])]))}},is=ce(os,[["__scopeId","data-v-31e6c17b"]]),ls={class:"team-status-card"},rs={class:"card-content"},cs={class:"grid"},us={style:{display:"flex","align-items":"center"}},ds=["src"],ms=me({__name:"ResourceInfo",setup(te){const n=[{itemId:2001,img:"/resource/173365468172811.png",name:""},{itemId:2002,img:"/resource/173349368626923.png",name:""},{itemId:2003,img:"/resource/173349368930929.png",name:""},{itemId:2004,img:"/resource/173349368981430.png",name:""},{itemId:2005,img:"/resource/173349368981431.png",name:""}],c=[{itemId:3007,img:"/resource/1744982743332104.png",name:""},{itemId:3201,img:"/resource/1745048651732168.png",name:""}],l=[{itemId:1011,img:"/resource/17370282349697.png",name:""},{itemId:1012,img:"/resource/17370282344616.png",name:""}],o=[{itemId:1022,img:"/resource/1744982743330101.png",name:""},{itemId:1023,img:"/resource/1745063950300111.png",name:""}],x=ie();le(),D(!1),D(!1),D(1),D([1,2,3,4]);const S=B(()=>x.selectedToken?x.getWebSocketStatus(x.selectedToken.id):"disconnected");B(()=>x.selectedTokenRoleInfo);const I=B(()=>{const i=x.selectedTokenRoleInfo,k=[];if(i&&i.role){const U=i.role.items;k.push({itemId:0,img:"/resource/1744982154749284.png",count:i.role.gold}),k.push({itemId:0,img:"/resource/1744982154832289.png",count:i.role.freeDiamond}),n.forEach(T=>{k.push({itemId:T.itemId,img:T.img,count:U[T.itemId].quantity})}),c.forEach(T=>{k.push({itemId:T.itemId,img:T.img,count:U[T.itemId].quantity})}),l.forEach(T=>{k.push({itemId:T.itemId,img:T.img,count:U[T.itemId].quantity})}),o.forEach(T=>{k.push({itemId:T.itemId,img:T.img,count:U[T.itemId].quantity})})}return k});return re(async()=>{x.selectedToken&&S.value==="connected"||(x.selectedToken?console.log("🛡️ WebSocket未连接，等待连接后自动获取队伍信息"):console.log("🛡️ 没有选中的Token，无法获取队伍信息"))}),(i,k)=>(g(),f("div",ls,[k[0]||(k[0]=e("div",{class:"card-header"},[e("div",{class:"team-info"},[e("h3",null,"资源信息")])],-1)),e("div",rs,[e("div",cs,[(g(!0),f(oe,null,de(I.value,(U,T)=>(g(),f("div",us,[e("img",{src:U.img,style:{width:"30px",height:"30px"}},null,8,ds),K(" "+C(U.count),1)]))),256))])])]))}}),ps=ce(ms,[["__scopeId","data-v-08f7810d"]]),gs={class:"game-status-container"},vs={class:"status-card bottle-helper"},fs={class:"card-header"},_s={class:"card-content"},ys={class:"time-display"},hs={class:"status-card hang-up"},ks={class:"card-header"},Ts={class:"status-info"},bs={class:"card-content"},ws={class:"time-display"},$s={class:"action-row"},Ss=["disabled"],Is={key:0,class:"loading-text"},xs={key:1},Cs=["disabled"],Ms={key:0,class:"loading-text"},Ds={key:1},Bs={class:"status-card legion-match"},Us={class:"card-header"},Ws={class:"card-content"},Es=["disabled"],Os={class:"status-card legion-signin"},Rs={class:"card-header"},zs={class:"card-content"},Hs={key:0,class:"club-name"},Ns={key:1,class:"description"},As=["disabled"],Ps={class:"status-card study"},Ls={class:"card-header"},Vs={class:"card-content"},Gs=["disabled"],js={key:0},qs={key:1,class:"loading-text"},Js={key:0},Qs={key:1},Ks={key:2},Xs={key:3},Ys={key:4},Zs={key:2},Fs={__name:"GameStatus",setup(te){const n=ie(),c=le(),l=D({isRunning:!1,remainingTime:0,stopTime:0}),o=D({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),x=D({isRegistered:!1}),S=D({isSignedIn:!1,clubName:""}),I=B(()=>n.gameData.studyStatus),i=B(()=>{var a;return((a=n.gameData)==null?void 0:a.roleInfo)||null}),k=a=>{const s=Math.floor(Number(a)||0);if(s<=0)return"00:00:00";const p=Math.floor(s/3600),v=Math.floor(s%3600/60),h=s%60;return`${p.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`},U=()=>{if(!i.value)return;const a=i.value.role;if(a.bottleHelpers){const s=Date.now()/1e3;l.value.stopTime=a.bottleHelpers.helperStopTime,l.value.isRunning=a.bottleHelpers.helperStopTime>s,l.value.remainingTime=Math.max(0,Math.floor(a.bottleHelpers.helperStopTime-s)),console.log("🤖 盐罐机器人状态更新:",{stopTime:a.bottleHelpers.helperStopTime,now:s,remainingTime:l.value.remainingTime,isRunning:l.value.isRunning})}if(a.hangUp){const s=Date.now()/1e3;o.value.lastTime=a.hangUp.lastTime,o.value.hangUpTime=a.hangUp.hangUpTime;const p=s-o.value.lastTime;p<=o.value.hangUpTime?(o.value.remainingTime=Math.floor(o.value.hangUpTime-p),o.value.isActive=!0):(o.value.remainingTime=0,o.value.isActive=!1),o.value.elapsedTime=Math.floor(o.value.hangUpTime-o.value.remainingTime),console.log("⏰ 挂机状态更新:",{lastTime:o.value.lastTime,hangUpTime:o.value.hangUpTime,elapsed:p,remainingTime:o.value.remainingTime,elapsedTime:o.value.elapsedTime,isActive:o.value.isActive})}if(a.statistics){const s=new Date;s.setHours(0,0,0,0);const p=s.getTime()/1e3;x.value.isRegistered=Number(a.statistics["last:legion:match:sign:up:time"])>p}if(a.statisticsTime){const s=new Date;s.setHours(0,0,0,0);const p=s.getTime()/1e3;S.value.isSignedIn=a.statisticsTime["legion:sign:in"]>p}};let T=null;const Z=()=>{T&&clearInterval(T),T=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1)),o.value.isActive&&o.value.remainingTime>0&&(o.value.remainingTime=Math.max(0,o.value.remainingTime-1),o.value.elapsedTime=o.value.elapsedTime+1,o.value.remainingTime<=0&&(o.value.isActive=!1))},1e3)},_=()=>{if(!n.selectedToken){c.warning("请先选择Token");return}const a=n.selectedToken.id;n.sendMessage(a,"bottlehelper_stop"),setTimeout(()=>{n.sendMessage(a,"bottlehelper_start"),n.sendMessage(a,"role_getroleinfo")},500),c.info(l.value.isRunning?"重启盐罐机器人":"启动盐罐机器人")},b=async()=>{if(!n.selectedToken){c.warning("请先选择Token");return}const a=n.selectedToken.id;try{console.log("🕐 开始加钟操作..."),o.value.isExtending=!0,c.info("正在加钟...");const s=[];for(let p=0;p<4;p++){const v=new Promise(h=>{setTimeout(()=>{console.log(`🕐 发送第${p+1}次加钟请求`);const M=n.sendMessage(a,"system_mysharecallback",{isSkipShareCard:!0,type:2});h(M)},p*300)});s.push(v)}await Promise.all(s),console.log("🕐 所有加钟请求已发送"),setTimeout(()=>{console.log("🕐 加钟后获取最新角色信息"),n.sendMessage(a,"role_getroleinfo")},1500),setTimeout(()=>{c.success("加钟操作已完成，请查看挂机剩余时间"),o.value.isExtending=!1},2500)}catch(s){console.error("🕐 加钟操作失败:",s),c.error("加钟操作失败: "+(s.message||"未知错误")),o.value.isExtending=!1}},W=async()=>{if(!n.selectedToken){c.warning("请先选择Token");return}const a=n.selectedToken.id;try{console.log("🎁 开始领取挂机奖励..."),o.value.isClaiming=!0,c.info("正在领取挂机奖励..."),n.sendMessage(a,"system_mysharecallback"),setTimeout(()=>{n.sendMessage(a,"system_claimhangupreward")},200),setTimeout(()=>{n.sendMessage(a,"system_mysharecallback",{isSkipShareCard:!0,type:2})},400),setTimeout(()=>{n.sendMessage(a,"role_getroleinfo")},600),setTimeout(()=>{c.success("挂机奖励领取完成"),o.value.isClaiming=!1},1200),console.log("🎁 挂机奖励领取操作序列已启动")}catch(s){console.error("🎁 领取挂机奖励失败:",s),c.error("领取挂机奖励失败: "+(s.message||"未知错误")),o.value.isClaiming=!1}},z=()=>{if(!n.selectedToken||x.value.isRegistered)return;const a=n.selectedToken.id;n.sendMessage(a,"legionmatch_rolesignup"),c.info("报名俱乐部排位")},q=()=>{if(!n.selectedToken||S.value.isSignedIn)return;const a=n.selectedToken.id;n.sendMessage(a,"legion_signin"),n.sendMessage(a,"role_getroleinfo"),c.info("俱乐部签到")},O=async()=>{if(!(!n.selectedToken||I.value.isAnswering)){if(I.value.isCompleted){c.success("✅ 咸鱼大冲关任务已完成，无需重复作答！");return}try{await he();const a=await Me();n.gameData.studyStatus={...n.gameData.studyStatus,isAnswering:!0,questionCount:0,answeredCount:0,status:"starting",timestamp:Date.now()};const s=n.selectedToken.id;n.sendMessage(s,"study_startgame"),setTimeout(()=>{n.gameData.studyStatus.isAnswering&&(n.gameData.studyStatus={...n.gameData.studyStatus,isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},c.warning("答题超时，已自动重置状态"))},3e4),c.info(`🚀 开始一键答题... (题库包含 ${a} 道题目)`)}catch(a){console.error("启动答题失败:",a),c.error("启动答题失败: "+a.message)}}};return Y(i,a=>{a&&U()},{deep:!0,immediate:!0}),re(()=>{if(U(),Z(),he().then(()=>{console.log("📚 答题数据预加载完成")}).catch(a=>{console.error("❌ 答题数据预加载失败:",a)}),n.selectedToken){const a=n.selectedToken.id;n.sendMessage(a,"legion_getinfo")}}),be(()=>{T&&clearInterval(T)}),(a,s)=>(g(),f("div",gs,[$(_t),$(Kt),$(is),e("div",vs,[e("div",fs,[s[1]||(s[1]=e("img",{src:Qe,alt:"盐罐图标",class:"status-icon"},null,-1)),s[2]||(s[2]=e("div",{class:"status-info"},[e("h3",null,"盐罐机器人"),e("p",null,"剩余时间")],-1)),e("div",{class:j(["status-badge",{active:l.value.isRunning}])},[s[0]||(s[0]=e("div",{class:"status-dot"},null,-1)),e("span",null,C(l.value.isRunning?"运行中":"已停止"),1)],2)]),e("div",_s,[e("div",ys,C(k(l.value.remainingTime)),1),e("button",{class:j(["action-button",{active:l.value.isRunning}]),onClick:_},C(l.value.isRunning?"重启服务":"启动服务"),3)])]),e("div",hs,[e("div",ks,[s[5]||(s[5]=e("img",{src:Ke,alt:"挂机图标",class:"status-icon"},null,-1)),e("div",Ts,[s[3]||(s[3]=e("h3",null,"挂机时间",-1)),e("p",null,"已挂机："+C(k(o.value.elapsedTime)),1)]),e("div",{class:j(["status-badge",{active:o.value.isActive}])},[s[4]||(s[4]=e("div",{class:"status-dot"},null,-1)),e("span",null,C(o.value.isActive?"挂机中":"已完成"),1)],2)]),e("div",bs,[e("div",ws,C(k(o.value.remainingTime)),1),e("div",$s,[e("button",{class:"action-button secondary",disabled:o.value.isExtending,onClick:b},[o.value.isExtending?(g(),f("span",Is,[...s[6]||(s[6]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 加钟中... ",-1)])])):(g(),f("span",xs,"加钟"))],8,Ss),e("button",{class:"action-button primary",disabled:o.value.isClaiming,onClick:W},[o.value.isClaiming?(g(),f("span",Ms,[...s[7]||(s[7]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),K(" 领取中... ",-1)])])):(g(),f("span",Ds,"领取奖励"))],8,Cs)])])]),e("div",Bs,[e("div",Us,[s[9]||(s[9]=e("img",{src:Xe,alt:"俱乐部图标",class:"status-icon"},null,-1)),s[10]||(s[10]=e("div",{class:"status-info"},[e("h3",null,"俱乐部排位"),e("p",null,"赛事状态")],-1)),e("div",{class:j(["status-badge",{active:x.value.isRegistered}])},[s[8]||(s[8]=e("div",{class:"status-dot"},null,-1)),e("span",null,C(x.value.isRegistered?"已报名":"未报名"),1)],2)]),e("div",Ws,[s[11]||(s[11]=e("p",{class:"description"},[K(" 每逢周三周四周五有比赛"),e("br"),K(" 立即报名参与精彩对决！ ")],-1)),e("button",{class:"action-button",disabled:x.value.isRegistered,onClick:z},C(x.value.isRegistered?"已报名":"立即报名"),9,Es)])]),e("div",Os,[e("div",Rs,[s[13]||(s[13]=e("img",{src:we,alt:"签到图标",class:"status-icon"},null,-1)),s[14]||(s[14]=e("div",{class:"status-info"},[e("h3",null,"俱乐部签到"),e("p",null,"每日签到状态")],-1)),e("div",{class:j(["status-badge",{active:S.value.isSignedIn}])},[s[12]||(s[12]=e("div",{class:"status-dot"},null,-1)),e("span",null,C(S.value.isSignedIn?"已签到":"待签到"),1)],2)]),e("div",zs,[S.value.clubName?(g(),f("p",Hs,[s[15]||(s[15]=K(" 当前俱乐部",-1)),s[16]||(s[16]=e("br",null,null,-1)),e("strong",null,C(S.value.clubName),1)])):(g(),f("p",Ns," 尚未加入任何俱乐部 ")),e("button",{class:"action-button",disabled:S.value.isSignedIn,onClick:q},C(S.value.isSignedIn?"已签到":"立即签到"),9,As)])]),e("div",Ps,[e("div",Ls,[s[18]||(s[18]=e("img",{src:Ye,alt:"学习图标",class:"status-icon"},null,-1)),s[19]||(s[19]=e("div",{class:"status-info"},[e("h3",null,"咸鱼大冲关"),e("p",null,"每日知识挑战")],-1)),e("div",{class:j(["status-badge weekly",{completed:I.value.isCompleted}])},[e("div",{class:j(["status-dot",{completed:I.value.isCompleted}])},null,2),s[17]||(s[17]=e("span",null,"每周任务",-1))],2)]),e("div",Vs,[s[21]||(s[21]=e("p",{class:"description"}," 没有什么可以阻挡我求知的欲望！ ",-1)),e("button",{class:j(["action-button",{completed:I.value.isCompleted}]),disabled:I.value.isAnswering||I.value.isCompleted,onClick:O},[I.value.isCompleted?(g(),f("span",js," ✅ 已完成无需作答 ")):I.value.isAnswering?(g(),f("span",qs,[s[20]||(s[20]=e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1)),I.value.status==="starting"?(g(),f("span",Js,"正在获取题目...")):I.value.status==="answering"?(g(),f("span",Qs,"答题中 "+C(I.value.answeredCount)+"/"+C(I.value.questionCount),1)):I.value.status==="claiming_rewards"?(g(),f("span",Ks,"正在领取奖励...")):I.value.status==="completed"?(g(),f("span",Xs,"答题完成")):(g(),f("span",Ys,"答题中..."))])):(g(),f("span",Zs,"🎯 一键答题"))],10,Gs)])])]))}},ea=ce(Fs,[["__scopeId","data-v-ceed32af"]]),ta={class:"game-features-page"},sa={class:"page-header"},aa={class:"container"},na={class:"header-content"},oa={class:"header-actions",style:{"justify-content":"center","align-items":"center"}},ia={key:0,style:{display:"flex","flex-direction":"row","align-items":"center"}},la=["src"],ra={style:{"margin-left":"8px","font-size":"14px"}},ca={class:"features-grid-section",style:{"padding-top":"var(--spacing-lg)"}},ua={class:"container"},da={class:"features-grid-section"},ma={class:"container"},pa={__name:"GameFeatures",setup(te){const n=De(),c=le(),l=ie();D(!0),D(null);const o=B(()=>l.selectedToken&&l.getWebSocketStatus(l.selectedToken.id)==="connected"?"connected":"disconnected");B(()=>l.selectedToken?l.getWebSocketStatus(l.selectedToken.id)==="connected"?"已连接":"未连接":"未选择Token"),B(()=>o.value==="connected"?"status-connected":"status-disconnected"),B(()=>o.value==="connected");const x=()=>{if(!l.selectedToken){c.warning("请先选择一个Token"),n.push("/tokens");return}try{const i=l.selectedToken.id,k=l.selectedToken.token;l.createWebSocketConnection(i,k),c.info("正在建立 WebSocket 连接..."),setTimeout(async()=>{l.getWebSocketStatus(i)==="connected"&&(c.success("WebSocket 连接成功"),await S())},2e3)}catch(i){console.error("WebSocket连接失败:",i),c.error("WebSocket连接失败")}};re(()=>{l.selectedToken&&(l.getWebSocketStatus(l.selectedToken.id)!=="connected"?x():S())});const S=async()=>{if(l.selectedToken)try{const i=l.selectedToken.id;console.log("🎮 初始化游戏数据..."),console.log("🎮 正在获取角色信息...");const k=l.sendMessage(i,"role_getroleinfo");console.log("🎮 角色信息请求结果:",k),console.log("🎮 正在获取塔信息...");const U=l.sendMessage(i,"tower_getinfo");console.log("🎮 塔信息请求结果:",U),console.log("🎮 正在获取队伍信息...");const T=l.sendMessage(i,"presetteam_getinfo");console.log("🎮 队伍信息请求结果:",T),console.log("🎮 游戏数据初始化请求已发送")}catch(i){console.warn("初始化游戏数据失败:",i)}};be(()=>{});const I=()=>{n.push("/roles")};return(i,k)=>{const U=ne("n-button");return g(),f("div",ta,[e("div",sa,[e("div",aa,[e("div",na,[k[1]||(k[1]=e("div",{class:"header-left"},[e("h1",{class:"page-title"}," 游戏功能 ")],-1)),e("div",oa,[G(l).gameData.roleInfo&&G(l).gameData.roleInfo.role?(g(),f("div",ia,[e("img",{style:{width:"40px",height:"40px","border-radius":"50%"},src:G(l).gameData.roleInfo.role.headImg},null,8,la),e("text",ra,C(G(l).gameData.roleInfo.role.name),1)])):ue("",!0),$(U,{type:"primary",onClick:I},{default:V(()=>[...k[0]||(k[0]=[K(" 切换角色 ",-1)])]),_:1})])])])]),e("div",ca,[e("div",ua,[$(ps)])]),e("div",da,[e("div",ma,[$(ea)])])])}}},ka=ce(pa,[["__scopeId","data-v-0f24a333"]]);export{ka as default};
