const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B2ntl-FI.js","assets/index-Om8NWQ_d.css"])))=>i.map(i=>d[i]);
import{e as de,u as ce,r as B,A as O,G as ue,c as k,o as A,h as o,w as n,m as p,a as s,i as D,k as fe,l as c,t as H,F as pe,n as ye,p as ve,_ as me}from"./index-B2ntl-FI.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"message-tester"},be={class:"space-y-4"},we={key:0},He={class:"grid grid-cols-2 gap-2"},Ve={class:"space-y-2"},Ce={class:"flex items-center justify-between w-full"},Ae={class:"flex items-center gap-2"},ke={class:"message-history max-h-96 overflow-y-auto"},Se={class:"flex justify-between items-center mb-2"},Be={class:"font-semibold"},Oe={class:"text-sm text-gray-500 ml-2"},Me={class:"flex items-center gap-1"},Ne={key:0,class:"text-sm mb-2"},xe={class:"mb-2"},ze={class:"text-xs text-gray-600 mb-1"},De={class:"text-sm bg-gray-50 p-2 rounded border max-h-20 overflow-hidden message-preview"},Te={class:"mt-2"},je={class:"json-display-container"},Le={class:"json-header"},Je={class:"json-content formatted"},he={class:"json-display-container"},$e={class:"json-header"},Ie={class:"json-content raw"},Ue={class:"json-display-container"},Ze={class:"json-header"},Re={class:"json-content compact"},Ge={key:0,class:"text-center text-gray-500 p-8"},We={__name:"MessageTester",setup(Ee){const v=de(),d=ce(),u=B(null),w=B(""),M=B("{}"),m=B([]),N=B(null),$=O(()=>v.gameTokens.map(e=>({label:e.name,value:e.id}))),x=O(()=>u.value?v.getWebSocketStatus(u.value):"disconnected"),I=O(()=>{switch(x.value){case"connected":return"success";case"connecting":return"warning";case"error":return"error";default:return"default"}}),U=O(()=>{switch(x.value){case"connected":return"🟢 已连接";case"connecting":return"🟡 连接中";case"error":return"🔴 连接错误";default:return"⚪ 未连接"}}),_=O(()=>u.value&&x.value==="connected"),Z=()=>{if(!u.value){d.error("请先选择一个token");return}const e=v.gameTokens.find(t=>t.id===u.value);if(e){console.log("🔧 MessageTester: 开始连接WebSocket",{tokenId:u.value,tokenName:e.name,hasToken:!!e.token});try{v.selectToken(u.value),d.success("正在建立WebSocket连接...")}catch(t){console.error("❌ MessageTester: WebSocket连接失败",t),d.error("WebSocket连接失败: "+t.message)}}else d.error("找不到选中的token")},R=async()=>{try{const{g_utils:e}=await me(async()=>{const{g_utils:r}=await import("./index-B2ntl-FI.js").then(a=>a.M);return{g_utils:r}},__vite__mapDeps([0,1])),t=new Uint8Array([8,2,5,4,114,111,108,101]);if(console.log("🧪 BON解码测试开始"),console.log("🔍 g_utils可用性检查:",{hasGUtils:!!e,hasBon:!!(e&&e.bon),hasBonDecode:!!(e&&e.bon&&e.bon.decode)}),e&&e.bon&&e.bon.decode){console.log("📥 测试数据:",t);const r=e.bon.decode(t);console.log("✅ BON解码成功:",r),d.success(`BON解码器工作正常: ${JSON.stringify(r)}`),V("test",{testType:"BON解码测试",input:Array.from(t),output:r,status:"success"},"bon_decode_test")}else console.error("❌ BON解码器不可用"),d.error("BON解码器不可用"),V("test",{testType:"BON解码测试",error:"BON解码器不可用",status:"error"},"bon_decode_test")}catch(e){console.error("❌ BON解码测试失败:",e),d.error("BON解码测试失败: "+e.message),V("test",{testType:"BON解码测试",error:e.message,status:"error"},"bon_decode_test")}},V=(e,t,r=null)=>{e!=="test"&&(r==="_sys/ack"||r==="heartbeat")||(m.value.unshift({type:e,timestamp:new Date().toISOString(),cmd:r,data:t}),m.value.length>50&&(m.value=m.value.slice(0,50)))},G=()=>{if(!_.value)return;v.sendHeartbeat(u.value)?d.success("心跳消息已发送"):d.error("心跳消息发送失败")},W=()=>{if(!_.value)return;v.sendGetRoleInfo(u.value)?(V("sent",{cmd:"role_getroleinfo"},"role_getroleinfo"),d.success("角色信息请求已发送")):d.error("角色信息请求发送失败")},E=()=>{if(!_.value)return;v.sendGameMessage(u.value,"system_getdatabundlever",{isAudit:!1})?(V("sent",{cmd:"system_getdatabundlever"},"system_getdatabundlever"),d.success("数据版本请求已发送")):d.error("数据版本请求发送失败")},F=()=>{if(!_.value)return;v.sendGameMessage(u.value,"system_signinreward",{})?(V("sent",{cmd:"system_signinreward"},"system_signinreward"),d.success("签到请求已发送")):d.error("签到请求发送失败")},P=()=>{if(!(!_.value||!w.value))try{const e=JSON.parse(M.value||"{}");v.sendGameMessage(u.value,w.value,e)?(V("sent",{cmd:w.value,body:e},w.value),d.success(`自定义消息 ${w.value} 已发送`),w.value="",M.value="{}"):d.error("自定义消息发送失败")}catch(e){d.error("消息体JSON格式错误: "+e.message)}},T=e=>new Date(e).toLocaleTimeString(),K=e=>e?e.includes("error")||e.includes("fail")?"error":e.includes("resp")||e.includes("response")?"success":e.includes("get")||e.includes("info")?"info":e.includes("send")||e.includes("start")?"primary":"default":"default",j=e=>{try{const t=JSON.stringify(e),r=new TextEncoder().encode(t).length;return r<1024?`${r}B`:r<1024*1024?`${(r/1024).toFixed(1)}KB`:`${(r/1024/1024).toFixed(1)}MB`}catch{return"未知大小"}},q=e=>{var t,r,a,l;if(!e)return"空数据";try{let g=e;(t=e._raw)!=null&&t.decodedBody||e.decodedBody?g=((r=e._raw)==null?void 0:r.decodedBody)||e.decodedBody:((a=e._raw)!=null&&a.rawData||e.rawData)&&(g=((l=e._raw)==null?void 0:l.rawData)||e.rawData);const C=JSON.stringify(g);return C.length>150?C.substring(0,150)+"...":C}catch{return"数据解析失败"}},Q=()=>{m.value=[],N.value=null,d.success("消息历史已清空")},X=()=>{try{const e={exportTime:new Date().toISOString(),tokenId:u.value,messages:m.value},t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download=`message-history-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),d.success("消息历史已导出")}catch(e){d.error("导出失败: "+e.message)}},S=async e=>{try{await navigator.clipboard.writeText(e),d.success("已复制到剪贴板")}catch{const r=document.createElement("textarea");r.value=e,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),d.success("已复制到剪贴板")}},Y=e=>{const t=`[${e.type.toUpperCase()}] ${T(e.timestamp)} - ${e.cmd||"无命令"}
${JSON.stringify(e.data,null,2)}`;S(t)},ee=e=>{S(JSON.stringify(e,null,2))},te=e=>{S(h(e))},se=e=>{S(JSON.stringify(e,null,2))},ne=e=>{S(JSON.stringify(e))},L=e=>{if(!e)return"null";if(Array.isArray(e))return`[Array: ${e.length} items]`;if(e instanceof Uint8Array)return`[Uint8Array: ${e.length} bytes]`;if(typeof e=="object"&&e.constructor===Object){const t=Object.keys(e);if(t.every(r=>!isNaN(parseInt(r))))return`[NumericObject: ${t.length} entries]`}return"[Unknown format]"},J=e=>{if(!e)return!1;if(Array.isArray(e)||e instanceof Uint8Array)return!0;if(typeof e=="object"&&e.constructor===Object){const t=Object.keys(e);return t.length>0&&t.every(r=>!isNaN(parseInt(r)))}return!1},h=(e,t=10,r=0)=>{try{if(!e)return"null";if(r>t)return"[超出最大深度限制]";let a=e;const l=e._raw||e;if(l.decodedBody||e.decodedBody){const b=l.decodedBody||e.decodedBody,f=l.body||e.body;e._raw?a={...e,_raw:{...e._raw,body:b,_originalBody:L(f),_note:"body已自动BON解码"}}:a={...e,body:b,_originalBody:L(f),_note:"body已自动BON解码"}}else if(l.rawData||e.rawData){const b=l.rawData||e.rawData;e._raw?a={...e,_raw:{...e._raw,body:b,_note:"body已使用rawData解码"}}:a={...e,body:b,_note:"body已使用rawData解码"}}else(l.body&&J(l.body)||e.body&&J(e.body))&&(a={...e,_note:"body为原始数据，可能需要BON解码"});const g=new WeakSet;return JSON.stringify(a,(b,f)=>{if(typeof f=="object"&&f!==null){if(g.has(f))return"[循环引用]";g.add(f)}return typeof f=="string"||Array.isArray(f),f},2)}catch(a){return`[JSON序列化错误: ${a.message}]`}};return ue(()=>v.wsConnections,e=>{if(!u.value||!e[u.value])return;const t=e[u.value];if(t.lastMessage){const r=t.lastMessage;if(N.value&&N.value.timestamp===r.timestamp)return;const a=r.data||r,l=a.cmd||r.cmd;l&&l!=="_sys/ack"&&l!=="heartbeat"&&(V("received",a,l),N.value=r)}},{deep:!0}),(e,t)=>{const r=p("n-select"),a=p("n-tag"),l=p("n-button"),g=p("n-divider"),C=p("n-input"),y=p("n-icon"),b=p("n-space"),f=p("n-tab-pane"),oe=p("n-tabs"),re=p("n-collapse-item"),le=p("n-collapse"),ae=p("n-card");return A(),k("div",ge,[o(ae,{title:"消息加解密测试",class:"mb-4"},{default:n(()=>[s("div",be,[s("div",null,[o(r,{value:u.value,"onUpdate:value":t[0]||(t[0]=i=>u.value=i),options:$.value,placeholder:"选择要测试的游戏Token",class:"w-full"},null,8,["value","options"])]),u.value?(A(),k("div",we,[o(a,{type:I.value},{default:n(()=>[c(H(U.value),1)]),_:1},8,["type"]),x.value!=="connected"?(A(),fe(l,{key:0,type:"primary",size:"small",class:"ml-2",onClick:Z},{default:n(()=>[...t[3]||(t[3]=[c(" 连接WebSocket ",-1)])]),_:1})):D("",!0),o(l,{type:"info",size:"small",class:"ml-2",onClick:R},{default:n(()=>[...t[4]||(t[4]=[c(" 🔓 测试BON解码 ",-1)])]),_:1})])):D("",!0),o(g,{"title-placement":"left"},{default:n(()=>[...t[5]||(t[5]=[c(" 预设消息测试 ",-1)])]),_:1}),s("div",He,[o(l,{disabled:!_.value,onClick:G},{default:n(()=>[...t[6]||(t[6]=[c(" 💗 发送心跳 ",-1)])]),_:1},8,["disabled"]),o(l,{disabled:!_.value,onClick:W},{default:n(()=>[...t[7]||(t[7]=[c(" 👤 获取角色信息 ",-1)])]),_:1},8,["disabled"]),o(l,{disabled:!_.value,onClick:E},{default:n(()=>[...t[8]||(t[8]=[c(" 📦 获取数据版本 ",-1)])]),_:1},8,["disabled"]),o(l,{disabled:!_.value,onClick:F},{default:n(()=>[...t[9]||(t[9]=[c(" 📅 签到 ",-1)])]),_:1},8,["disabled"])]),o(g,{"title-placement":"left"},{default:n(()=>[...t[10]||(t[10]=[c(" 自定义消息 ",-1)])]),_:1}),s("div",Ve,[o(C,{value:w.value,"onUpdate:value":t[1]||(t[1]=i=>w.value=i),placeholder:"命令 (例如: role_getroleinfo)",class:"w-full"},null,8,["value"]),o(C,{value:M.value,"onUpdate:value":t[2]||(t[2]=i=>M.value=i),type:"textarea",placeholder:'消息体 JSON (例如: {"clientVersion": "1.65.3-wx"})',rows:3,class:"w-full"},null,8,["value"]),o(l,{disabled:!_.value||!w.value,type:"primary",onClick:P},{default:n(()=>[...t[11]||(t[11]=[c(" 🚀 发送自定义消息 ",-1)])]),_:1},8,["disabled"])]),o(g,{"title-placement":"left"},{default:n(()=>[s("div",Ce,[t[16]||(t[16]=s("span",null,"消息历史",-1)),s("div",Ae,[o(l,{size:"small",type:"error",secondary:"",onClick:Q,disabled:m.value.length===0},{default:n(()=>[o(y,{size:"14",class:"mr-1"},{default:n(()=>[...t[12]||(t[12]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})],-1)])]),_:1}),t[13]||(t[13]=c(" 清空 ",-1))]),_:1},8,["disabled"]),o(l,{size:"small",type:"info",secondary:"",onClick:X,disabled:m.value.length===0},{default:n(()=>[o(y,{size:"14",class:"mr-1"},{default:n(()=>[...t[14]||(t[14]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)])]),_:1}),t[15]||(t[15]=c(" 导出 ",-1))]),_:1},8,["disabled"])])])]),_:1}),s("div",ke,[(A(!0),k(pe,null,ye(m.value,(i,ie)=>(A(),k("div",{key:ie,class:ve(["message-item p-3 mb-2 rounded border",i.type==="sent"?"bg-blue-50 border-blue-200":i.type==="test"?"bg-purple-50 border-purple-200":"bg-green-50 border-green-200"])},[s("div",Se,[s("span",Be,[c(H(i.type==="sent"?"📤 发送":i.type==="test"?"🧪 测试":"📨 接收")+" ",1),s("span",Oe,H(T(i.timestamp)),1)]),s("div",Me,[o(l,{size:"tiny",type:"tertiary",onClick:z=>Y(i),title:"复制消息"},{default:n(()=>[o(y,{size:"12"},{default:n(()=>[...t[17]||(t[17]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"})],-1)])]),_:1})]),_:1},8,["onClick"]),o(l,{size:"tiny",type:"tertiary",onClick:z=>ee(i.data),title:"复制JSON数据"},{default:n(()=>[o(y,{size:"12"},{default:n(()=>[...t[18]||(t[18]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M5,3H7V5H5V10A2,2 0 0,1 3,8V6A2,2 0 0,1 5,4V3M19,3V4A2,2 0 0,1 21,6V8A2,2 0 0,1 19,10V5H17V3H19M16,12A2,2 0 0,1 18,10H20A2,2 0 0,1 22,12A2,2 0 0,1 20,14H18A2,2 0 0,1 16,12M20,12V14H18V12H20M4,10A2,2 0 0,1 6,12A2,2 0 0,1 4,14H2A2,2 0 0,1 0,12A2,2 0 0,1 2,10H4M2,12V10H4V12H2M5,19V21H7V19H5V14A2,2 0 0,1 3,16V18A2,2 0 0,1 5,20V19M19,19V20A2,2 0 0,1 17,18V16A2,2 0 0,1 19,14V19H21V21H19Z"})],-1)])]),_:1})]),_:1},8,["onClick"])])]),i.cmd?(A(),k("div",Ne,[t[19]||(t[19]=s("strong",null,"命令:",-1)),o(a,{size:"small",type:K(i.cmd)},{default:n(()=>[c(H(i.cmd),1)]),_:2},1032,["type"])])):D("",!0),s("div",xe,[s("div",ze," 消息预览 ("+H(j(i.data))+"): ",1),s("div",De,H(q(i.data)),1)]),s("div",Te,[o(le,null,{default:n(()=>[o(re,{title:`详细数据 (${j(i.data)})`,name:"detail"},{default:n(()=>[o(oe,{type:"card",size:"small",animated:""},{default:n(()=>[o(f,{name:"formatted","display-directive":"show:lazy"},{tab:n(()=>[o(y,{size:"14",class:"mr-1"},{default:n(()=>[...t[20]||(t[20]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3Z"})],-1)])]),_:1}),t[21]||(t[21]=c(" 格式化显示 ",-1))]),default:n(()=>[s("div",je,[s("div",Le,[o(b,{size:"small"},{default:n(()=>[o(a,{size:"small",type:"info"},{default:n(()=>[...t[22]||(t[22]=[c("格式化",-1)])]),_:1}),o(l,{size:"tiny",type:"primary",ghost:"",onClick:z=>te(i.data),title:"复制格式化JSON"},{default:n(()=>[o(y,{size:"12",class:"mr-1"},{default:n(()=>[...t[23]||(t[23]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"})],-1)])]),_:1}),t[24]||(t[24]=c(" 复制 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),s("pre",Je,H(h(i.data)),1)])]),_:2},1024),o(f,{name:"raw","display-directive":"show:lazy"},{tab:n(()=>[o(y,{size:"14",class:"mr-1"},{default:n(()=>[...t[25]||(t[25]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"})],-1)])]),_:1}),t[26]||(t[26]=c(" 原始数据 ",-1))]),default:n(()=>[s("div",he,[s("div",$e,[o(b,{size:"small"},{default:n(()=>[o(a,{size:"small",type:"warning"},{default:n(()=>[...t[27]||(t[27]=[c("原始",-1)])]),_:1}),o(l,{size:"tiny",type:"warning",ghost:"",onClick:z=>se(i.data),title:"复制原始JSON"},{default:n(()=>[o(y,{size:"12",class:"mr-1"},{default:n(()=>[...t[28]||(t[28]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"})],-1)])]),_:1}),t[29]||(t[29]=c(" 复制 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),s("pre",Ie,H(JSON.stringify(i.data,null,2)),1)])]),_:2},1024),o(f,{name:"compact","display-directive":"show:lazy"},{tab:n(()=>[o(y,{size:"14",class:"mr-1"},{default:n(()=>[...t[30]||(t[30]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M4,6H20V16H4M20,18A2,2 0 0,0 22,16V6C22,4.89 21.1,4 20,4H4C2.89,4 2,4.89 2,6V16A2,2 0 0,0 4,18H0V20H24V18H20Z"})],-1)])]),_:1}),t[31]||(t[31]=c(" 紧凑显示 ",-1))]),default:n(()=>[s("div",Ue,[s("div",Ze,[o(b,{size:"small"},{default:n(()=>[o(a,{size:"small",type:"success"},{default:n(()=>[...t[32]||(t[32]=[c("紧凑",-1)])]),_:1}),o(l,{size:"tiny",type:"success",ghost:"",onClick:z=>ne(i.data),title:"复制紧凑JSON"},{default:n(()=>[o(y,{size:"12",class:"mr-1"},{default:n(()=>[...t[33]||(t[33]=[s("svg",{viewBox:"0 0 24 24"},[s("path",{fill:"currentColor",d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"})],-1)])]),_:1}),t[34]||(t[34]=c(" 复制 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),s("pre",Re,H(JSON.stringify(i.data)),1)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)])],2))),128)),m.value.length===0?(A(),k("div",Ge,[...t[35]||(t[35]=[s("div",{class:"text-lg mb-2"},"📭",-1),s("div",null,"暂无消息历史",-1),s("div",{class:"text-xs mt-1"},"发送消息后将在此显示",-1)])])):D("",!0)])])]),_:1})])}}},Ke=_e(We,[["__scopeId","data-v-b82109c8"]]);export{Ke as default};
