const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/wsAgent-BbW_CccE.js","assets/index-B2ntl-FI.js","assets/index-Om8NWQ_d.css","assets/gameCommands-CEPtqqjl.js"])))=>i.map(i=>d[i]);
import{d as Z,c as N,o as J,a as t,x as q,r as P,A as V,_ as X,u as ee,b as te,h as c,w as g,l as U,j as O,N as G,m as R,t as W,F as oe,n as ne,s as E,f as I,g as re,v as ae}from"./index-B2ntl-FI.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as Y}from"./Refresh-hxtgiIzy.js";import{C as le}from"./CloudUpload-DY82Mkvt.js";import{E as ce,S as ie,T as ue,C as de}from"./TrashBin-bVr5yFjC.js";const me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ge=t("rect",{x:"128",y:"128",width:"336",height:"336",rx:"57",ry:"57",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),ve=t("path",{d:"M383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),fe=[ge,ve],ke=Z({name:"CopyOutline",render:function(n,l){return J(),N("svg",me,fe)}}),pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},we=t("path",{d:"M376 160H272v153.37l52.69-52.68a16 16 0 0 1 22.62 22.62l-80 80a16 16 0 0 1-22.62 0l-80-80a16 16 0 0 1 22.62-22.62L240 313.37V160H136a56.06 56.06 0 0 0-56 56v208a56.06 56.06 0 0 0 56 56h240a56.06 56.06 0 0 0 56-56V216a56.06 56.06 0 0 0-56-56z",fill:"currentColor"},null,-1),Te=t("path",{d:"M272 48a16 16 0 0 0-32 0v112h32z",fill:"currentColor"},null,-1),he=[we,Te],Se=Z({name:"Download",render:function(n,l){return J(),N("svg",pe,he)}}),K=q("localToken",()=>{const v=P(localStorage.getItem("userToken")||null),n=P(JSON.parse(localStorage.getItem("gameTokens")||"{}")),l=P({}),m=V(()=>!!v.value),A=V(()=>Object.keys(n.value).length>0),h=o=>{v.value=o,localStorage.setItem("userToken",o)},_=()=>{v.value=null,localStorage.removeItem("userToken")},T=(o,e)=>{const s={...e,roleId:o,createdAt:new Date().toISOString(),lastUsed:new Date().toISOString()};return n.value[o]=s,localStorage.setItem("gameTokens",JSON.stringify(n.value)),s},x=o=>{const e=n.value[o];return e&&(e.lastUsed=new Date().toISOString(),localStorage.setItem("gameTokens",JSON.stringify(n.value))),e},L=(o,e)=>{n.value[o]&&(n.value[o]={...n.value[o],...e,updatedAt:new Date().toISOString()},localStorage.setItem("gameTokens",JSON.stringify(n.value)))},p=o=>{delete n.value[o],localStorage.setItem("gameTokens",JSON.stringify(n.value)),l.value[o]&&$(o)},u=()=>{Object.keys(l.value).forEach(o=>{$(o)}),n.value={},localStorage.removeItem("gameTokens")},f=async(o,e,s=null)=>{l.value[o]&&$(o);try{const{WsAgent:a}=await X(async()=>{const{WsAgent:w}=await import("./wsAgent-BbW_CccE.js");return{WsAgent:w}},__vite__mapDeps([0,1,2])),{gameCommands:i}=await X(async()=>{const{gameCommands:w}=await import("./gameCommands-CEPtqqjl.js");return{gameCommands:w}},__vite__mapDeps([3,1,2]));let k=e;try{const w=e.replace(/^data:.*base64,/,"").trim(),H=atob(w);try{const Q=JSON.parse(H);k=Q.token||Q.gameToken||H}catch{k=H}}catch(w){console.warn("Base64è§£æžå¤±è´¥ï¼Œä½¿ç”¨åŽŸå§‹token:",w.message),k=e}const d=new a({heartbeatInterval:2e3,queueInterval:50,channel:"x",autoReconnect:!0,maxReconnectAttempts:5});d.onOpen=()=>{console.log(`âœ… WebSocketè¿žæŽ¥å·²å»ºç«‹: ${o}`),l.value[o].status="connected",l.value[o].connectedAt=new Date().toISOString(),setTimeout(()=>{d.send(i.role_getroleinfo(0,0,{roleId:o})),d.send(i.system_getdatabundlever())},1e3)},d.onMessage=w=>{console.log(`ðŸ“¨ æ”¶åˆ°æ¶ˆæ¯ [${o}]:`,w),w.cmd&&S(o,w)},d.onError=w=>{console.error(`âŒ WebSocketé”™è¯¯ [${o}]:`,w),l.value[o]&&(l.value[o].status="error",l.value[o].lastError=w.message)},d.onClose=w=>{console.log(`ðŸ”Œ WebSocketè¿žæŽ¥å·²å…³é—­ [${o}]:`,w.code,w.reason),l.value[o]&&(l.value[o].status="disconnected")},d.onReconnect=w=>{console.log(`ðŸ”„ WebSocketé‡è¿žä¸­ [${o}] ç¬¬${w}æ¬¡`),l.value[o]&&(l.value[o].status="reconnecting",l.value[o].reconnectAttempt=w)};const C=s||a.buildUrl("wss://xxz-xyzw.hortorgames.com/agent",{p:k,e:"x",lang:"chinese"});return l.value[o]={agent:d,gameCommands:i,status:"connecting",roleId:o,wsUrl:C,actualToken:k,createdAt:new Date().toISOString(),lastError:null,reconnectAttempt:0},await d.connect(C),d}catch(a){return console.error(`åˆ›å»ºWebSocketè¿žæŽ¥å¤±è´¥ [${o}]:`,a),l.value[o]&&(l.value[o].status="error",l.value[o].lastError=a.message),null}},S=(o,e)=>{const{cmd:s,body:a}=e;switch(s){case"role_getroleinfo":console.log(`è§’è‰²ä¿¡æ¯ [${o}]:`,a);break;case"system_getdatabundlever":console.log(`æ•°æ®åŒ…ç‰ˆæœ¬ [${o}]:`,a);break;case"task_claimdailyreward":console.log(`æ¯æ—¥ä»»åŠ¡å¥–åŠ± [${o}]:`,a);break;case"system_signinreward":console.log(`ç­¾åˆ°å¥–åŠ± [${o}]:`,a);break;default:console.log(`æœªå¤„ç†çš„æ¶ˆæ¯ [${o}] ${s}:`,a)}},$=o=>{const e=l.value[o];e&&(e.agent&&typeof e.agent.close=="function"?e.agent.close():e.connection&&typeof e.connection.close=="function"&&e.connection.close(),delete l.value[o])},M=o=>{var e;return((e=l.value[o])==null?void 0:e.status)||"disconnected"},D=(o,e,s={})=>{const a=l.value[o];if(!a||!a.agent)return console.warn(`è§’è‰² ${o} çš„WebSocketè¿žæŽ¥ä¸å­˜åœ¨`),!1;if(a.status!=="connected")return console.warn(`è§’è‰² ${o} çš„WebSocketæœªè¿žæŽ¥`),!1;try{const{gameCommands:i}=a;if(typeof i[e]=="function"){const k=i[e](0,0,s);return a.agent.send(k),console.log(`å‘é€æ¸¸æˆå‘½ä»¤ [${o}] ${e}:`,s),!0}else return console.error(`æœªçŸ¥çš„æ¸¸æˆå‘½ä»¤: ${e}`),!1}catch(i){return console.error(`å‘é€æ¸¸æˆå‘½ä»¤å¤±è´¥ [${o}] ${e}:`,i),!1}},j=async(o,e,s={},a=8e3)=>{const i=l.value[o];if(!i||!i.agent)throw new Error(`è§’è‰² ${o} çš„WebSocketè¿žæŽ¥ä¸å­˜åœ¨`);if(i.status!=="connected")throw new Error(`è§’è‰² ${o} çš„WebSocketæœªè¿žæŽ¥`);try{const{gameCommands:k}=i;if(typeof k[e]=="function"){const d=await i.agent.sendWithPromise({cmd:e,body:s,timeout:a});return console.log(`æ¸¸æˆå‘½ä»¤å“åº” [${o}] ${e}:`,d),d}else throw new Error(`æœªçŸ¥çš„æ¸¸æˆå‘½ä»¤: ${e}`)}catch(k){throw console.error(`å‘é€æ¸¸æˆå‘½ä»¤å¤±è´¥ [${o}] ${e}:`,k),k}},z=o=>{const e=l.value[o];return e?{status:e.status,roleId:e.roleId,wsUrl:e.wsUrl,connectedAt:e.connectedAt,createdAt:e.createdAt,lastError:e.lastError,reconnectAttempt:e.reconnectAttempt,agentStatus:e.agent?e.agent.getStatus():null}:{status:"disconnected",roleId:o,error:"è¿žæŽ¥ä¸å­˜åœ¨"}},B=()=>({userToken:v.value,gameTokens:n.value,exportedAt:new Date().toISOString()}),y=o=>{try{return o.userToken&&h(o.userToken),o.gameTokens&&(n.value=o.gameTokens,localStorage.setItem("gameTokens",JSON.stringify(n.value))),{success:!0,message:"Tokenå¯¼å…¥æˆåŠŸ"}}catch(e){return console.error("Tokenå¯¼å…¥å¤±è´¥:",e),{success:!1,message:"å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯"}}},r=()=>{const o=new Date,e=new Date(o.getTime()-24*60*60*1e3),s={};let a=0;return Object.entries(n.value).forEach(([i,k])=>{new Date(k.lastUsed||k.createdAt)>e?s[i]=k:(a++,l.value[i]&&$(i))}),n.value=s,localStorage.setItem("gameTokens",JSON.stringify(n.value)),a};return{userToken:v,gameTokens:n,wsConnections:l,isUserAuthenticated:m,hasGameTokens:A,setUserToken:h,clearUserToken:_,addGameToken:T,getGameToken:x,updateGameToken:L,removeGameToken:p,clearAllGameTokens:u,createWebSocketConnection:f,closeWebSocketConnection:$,getWebSocketStatus:M,getWebSocketDetails:z,sendGameCommand:D,sendGameCommandWithPromise:j,exportTokens:B,importTokens:y,cleanExpiredTokens:r,initTokenManager:()=>{const o=localStorage.getItem("userToken"),e=localStorage.getItem("gameTokens");if(o&&(v.value=o),e)try{n.value=JSON.parse(e)}catch(s){console.error("è§£æžæ¸¸æˆtokenæ•°æ®å¤±è´¥:",s),n.value={}}r()}}}),_e=q("auth",()=>{const v=P(null),n=P(localStorage.getItem("token")||null),l=P(!1),m=K(),A=V(()=>!!n.value&&!!v.value),h=V(()=>v.value),_=async u=>{try{l.value=!0;const f={id:"local_user_"+Date.now(),username:u.username,email:u.email||`${u.username}@local.game`,avatar:"/icons/xiaoyugan.png",createdAt:new Date().toISOString()},S="local_token_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return n.value=S,v.value=f,localStorage.setItem("token",n.value),localStorage.setItem("user",JSON.stringify(v.value)),m.setUserToken(S),{success:!0}}catch(f){return console.error("ç™»å½•é”™è¯¯:",f),{success:!1,message:"æœ¬åœ°è®¤è¯å¤±è´¥"}}finally{l.value=!1}},T=async u=>{try{l.value=!0;const f=JSON.parse(localStorage.getItem("registeredUsers")||"[]");if(f.some(M=>M.username===u.username))return{success:!1,message:"ç”¨æˆ·åå·²å­˜åœ¨"};const $={...u,id:"user_"+Date.now(),createdAt:new Date().toISOString()};return f.push($),localStorage.setItem("registeredUsers",JSON.stringify(f)),{success:!0,message:"æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•"}}catch(f){return console.error("æ³¨å†Œé”™è¯¯:",f),{success:!1,message:"æœ¬åœ°æ³¨å†Œå¤±è´¥"}}finally{l.value=!1}},x=()=>{v.value=null,n.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("gameRoles"),m.clearUserToken(),m.clearAllGameTokens()};return{user:v,token:n,isLoading:l,isAuthenticated:A,userInfo:h,login:_,register:T,logout:x,fetchUserInfo:async()=>{try{if(!n.value)return!1;const u=localStorage.getItem("user");if(u)try{return v.value=JSON.parse(u),!0}catch(f){return console.error("è§£æžç”¨æˆ·ä¿¡æ¯å¤±è´¥:",f),x(),!1}else return x(),!1}catch(u){return console.error("èŽ·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",u),x(),!1}},initAuth:async()=>{const u=localStorage.getItem("user");if(n.value&&u)try{v.value=JSON.parse(u),m.initTokenManager()}catch(f){console.error("åˆå§‹åŒ–è®¤è¯å¤±è´¥:",f),x()}}}}),ye=q("gameRoles",()=>{const v=P([]),n=P(!1),l=P(null),m=K();return{gameRoles:v,isLoading:n,selectedRole:l,fetchGameRoles:async()=>{try{n.value=!0;const p=localStorage.getItem("gameRoles");if(p)try{v.value=JSON.parse(p)}catch(u){console.error("è§£æžæ¸¸æˆè§’è‰²æ•°æ®å¤±è´¥:",u),v.value=[]}else v.value=[];return{success:!0}}catch(p){return console.error("èŽ·å–æ¸¸æˆè§’è‰²å¤±è´¥:",p),{success:!1,message:"æœ¬åœ°æ•°æ®è¯»å–å¤±è´¥"}}finally{n.value=!1}},addGameRole:async p=>{try{n.value=!0;const u="role_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),f="game_token_"+Date.now()+"_"+Math.random().toString(36).substr(2,16),S={...p,id:u,createdAt:new Date().toISOString(),isActive:!1,exp:0,gold:1e3,vip:!1,avatar:p.avatar||"/icons/xiaoyugan.png"};v.value.push(S),localStorage.setItem("gameRoles",JSON.stringify(v.value));const $={token:f,roleId:u,roleName:S.name,server:S.server,wsUrl:null,createdAt:new Date().toISOString(),isActive:!0};return m.addGameToken(u,$),{success:!0,message:"æ·»åŠ è§’è‰²æˆåŠŸï¼Œå·²ç”Ÿæˆæ¸¸æˆtoken"}}catch(u){return console.error("æ·»åŠ æ¸¸æˆè§’è‰²å¤±è´¥:",u),{success:!1,message:"æ·»åŠ è§’è‰²å¤±è´¥"}}finally{n.value=!1}},updateGameRole:async(p,u)=>{try{n.value=!0;const f=v.value.findIndex(S=>S.id===p);if(f!==-1){v.value[f]={...v.value[f],...u,updatedAt:new Date().toISOString()},localStorage.setItem("gameRoles",JSON.stringify(v.value));const S=m.getGameToken(p);return S&&m.updateGameToken(p,{roleName:u.name||S.roleName,server:u.server||S.server}),{success:!0,message:"æ›´æ–°è§’è‰²æˆåŠŸ"}}else return{success:!1,message:"è§’è‰²ä¸å­˜åœ¨"}}catch(f){return console.error("æ›´æ–°æ¸¸æˆè§’è‰²å¤±è´¥:",f),{success:!1,message:"æ›´æ–°è§’è‰²å¤±è´¥"}}finally{n.value=!1}},deleteGameRole:async p=>{try{return n.value=!0,v.value=v.value.filter(u=>u.id!==p),localStorage.setItem("gameRoles",JSON.stringify(v.value)),m.removeGameToken(p),l.value&&l.value.id===p&&(l.value=null,localStorage.removeItem("selectedRole")),{success:!0,message:"åˆ é™¤è§’è‰²æˆåŠŸï¼Œå·²æ¸…ç†ç›¸å…³token"}}catch(u){return console.error("åˆ é™¤æ¸¸æˆè§’è‰²å¤±è´¥:",u),{success:!1,message:"åˆ é™¤è§’è‰²å¤±è´¥"}}finally{n.value=!1}},selectRole:p=>{l.value=p,localStorage.setItem("selectedRole",JSON.stringify(p));const u=m.getGameToken(p.id);if(u&&u.token)try{m.createWebSocketConnection(p.id,u.token,u.wsUrl),console.log(`å·²ä¸ºè§’è‰² ${p.name} å»ºç«‹WebSocketè¿žæŽ¥`)}catch(f){console.error(`å»ºç«‹WebSocketè¿žæŽ¥å¤±è´¥ [${p.name}]:`,f)}},initGameRoles:()=>{const p=localStorage.getItem("gameRoles"),u=localStorage.getItem("selectedRole");if(p)try{v.value=JSON.parse(p)}catch(f){console.error("è§£æžç¼“å­˜çš„æ¸¸æˆè§’è‰²æ•°æ®å¤±è´¥:",f)}if(u)try{l.value=JSON.parse(u)}catch(f){console.error("è§£æžç¼“å­˜çš„é€‰ä¸­è§’è‰²æ•°æ®å¤±è´¥:",f)}}}}),be={class:"token-manager"},Ue={class:"header"},$e={class:"header-actions"},xe={class:"token-section"},Ce={key:0,class:"token-item"},Oe={class:"token-info"},Re={class:"token-value"},Ae={key:1,class:"empty-token"},We={class:"token-section"},Ee={class:"game-tokens-list"},Pe={class:"token-header"},Ge={class:"role-info"},Ne={class:"role-name"},Je={class:"role-server"},Le={class:"token-actions"},Me={class:"token-details"},De={class:"detail-item"},je={class:"detail-value"},ze={class:"detail-item"},Be={class:"detail-value"},Fe={class:"detail-item"},Ve={class:"detail-value"},He={class:"detail-item"},Ie={class:"detail-value"},qe={class:"detail-item"},Ke={class:"bulk-actions"},Qe={__name:"TokenManager",setup(v){const n=ee(),l=te(),m=K(),A=ye(),h=e=>{if(!e)return"";const s=e.length;return s<=8?e:e.substring(0,4)+"***"+e.substring(s-4)},_=e=>new Date(e).toLocaleString("zh-CN"),T=e=>m.getWebSocketStatus(e),x=e=>{switch(e){case"connected":return"success";case"error":return"error";case"connecting":return"warning";default:return"default"}},L=e=>{switch(e){case"connected":return"å·²è¿žæŽ¥";case"error":return"è¿žæŽ¥é”™è¯¯";case"connecting":return"è¿žæŽ¥ä¸­";default:return"æœªè¿žæŽ¥"}},p=e=>{const s=[{label:"ç¼–è¾‘",key:"edit",icon:()=>E(G,null,{default:()=>E(de)})},{label:"å¤åˆ¶Token",key:"copy",icon:()=>E(G,null,{default:()=>E(ke)})}];return e.importMethod==="url"&&e.sourceUrl?s.unshift({label:"ä»ŽURLåˆ·æ–°",key:"refresh-url",icon:()=>E(G,null,{default:()=>E(ie)})}):s.unshift({label:"åˆ·æ–°Token",key:"refresh",icon:()=>E(G,null,{default:()=>E(Y)})}),s.push({type:"divider"},{label:"åˆ é™¤",key:"delete",icon:()=>E(G,null,{default:()=>E(ue)})}),s},u=(e,s,a)=>{switch(e){case"edit":j();break;case"copy":z(a.token);break;case"refresh":M(s);break;case"refresh-url":B(s,a);break;case"delete":D(s);break}},f=()=>{m.initTokenManager(),n.success("Tokenæ•°æ®å·²åˆ·æ–°")},S=()=>{l.warning({title:"æ¸…é™¤ç”¨æˆ·Token",content:"ç¡®å®šè¦æ¸…é™¤ç”¨æˆ·è®¤è¯Tokenå—ï¼Ÿè¿™å°†ä¼šé€€å‡ºç™»å½•ã€‚",positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:()=>{m.clearUserToken(),n.success("ç”¨æˆ·Tokenå·²æ¸…é™¤")}})},$=(e,s)=>{if(T(e)==="connected")m.closeWebSocketConnection(e),n.info("WebSocketè¿žæŽ¥å·²æ–­å¼€");else try{m.createWebSocketConnection(e,s.token,s.wsUrl),n.success("æ­£åœ¨å»ºç«‹WebSocketè¿žæŽ¥...")}catch{n.error("å»ºç«‹WebSocketè¿žæŽ¥å¤±è´¥")}},M=e=>{const s=m.getGameToken(e);if(!s){n.error("æ‰¾ä¸åˆ°å¯¹åº”çš„Tokenæ•°æ®");return}if(!s.sourceUrl){n.warning("è¯¥Tokenæ²¡æœ‰é…ç½®æºåœ°å€ï¼Œæ— æ³•é‡æ–°ç”Ÿæˆã€‚è¯·æ‰‹åŠ¨é‡æ–°å¯¼å…¥Tokenã€‚");return}l.info({title:"é‡æ–°èŽ·å–Token",content:"ç¡®å®šè¦ä»Žæºåœ°å€é‡æ–°èŽ·å–æ­¤è§’è‰²çš„Tokenå—ï¼Ÿ",positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{const a=n.loading("æ­£åœ¨é‡æ–°èŽ·å–Token...",{duration:0});let i;const k=s.sourceUrl;if(k.startsWith(window.location.origin)||k.startsWith("/")||k.startsWith("http://localhost")||k.startsWith("http://127.0.0.1"))i=await fetch(k);else try{i=await fetch(k,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(C){throw new Error(`è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ã€‚è¯·ç¡®ä¿ç›®æ ‡æœåŠ¡å™¨æ”¯æŒCORSã€‚é”™è¯¯è¯¦æƒ…: ${C.message}`)}if(!i.ok)throw new Error(`è¯·æ±‚å¤±è´¥: ${i.status} ${i.statusText}`);const b=await i.json();if(!b.token)throw new Error("è¿”å›žæ•°æ®ä¸­æœªæ‰¾åˆ°tokenå­—æ®µ");m.updateGameToken(e,{token:b.token,server:b.server||s.server,regeneratedAt:new Date().toISOString(),lastRefreshed:new Date().toISOString()}),m.getWebSocketStatus(e)==="connected"&&(m.closeWebSocketConnection(e),setTimeout(()=>{m.createWebSocketConnection(e,b.token,s.wsUrl)},500)),a.destroy(),n.success("Tokenå·²æˆåŠŸé‡æ–°èŽ·å–")}catch(a){console.error("é‡æ–°èŽ·å–Tokenå¤±è´¥:",a),n.error(a.message||"Tokené‡æ–°èŽ·å–å¤±è´¥")}}})},D=e=>{l.warning({title:"åˆ é™¤Token",content:"ç¡®å®šè¦åˆ é™¤æ­¤è§’è‰²çš„æ¸¸æˆTokenå—ï¼Ÿè¿™å°†æ–­å¼€ç›¸å…³çš„WebSocketè¿žæŽ¥ã€‚",positiveText:"ç¡®å®šåˆ é™¤",negativeText:"å–æ¶ˆ",onPositiveClick:()=>{m.removeGameToken(e),n.success("Tokenå·²åˆ é™¤")}})},j=(e,s)=>{n.info("ç¼–è¾‘åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­")},z=async e=>{try{await navigator.clipboard.writeText(e),n.success("Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),n.success("Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}},B=async(e,s)=>{if(!s.sourceUrl){n.warning("è¯¥Tokenæ²¡æœ‰é…ç½®æºURL");return}l.info({title:"ä»ŽURLåˆ·æ–°Token",content:`ç¡®å®šè¦ä»ŽæºURLé‡æ–°èŽ·å–Tokenå—ï¼Ÿ
æºåœ°å€ï¼š${s.sourceUrl}`,positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:async()=>{try{const a=n.loading("æ­£åœ¨ä»ŽURLèŽ·å–æ–°Token...",{duration:0});let i;if(s.sourceUrl.startsWith(window.location.origin)||s.sourceUrl.startsWith("/")||s.sourceUrl.startsWith("http://localhost")||s.sourceUrl.startsWith("http://127.0.0.1"))i=await fetch(s.sourceUrl);else{const b=`/api/proxy?url=${encodeURIComponent(s.sourceUrl)}`;i=await fetch(b)}if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const d=await i.json();if(!d.token)throw new Error("è¿”å›žæ•°æ®ä¸­æœªæ‰¾åˆ°tokenå­—æ®µ");m.updateGameToken(e,{token:d.token,lastUsed:new Date().toISOString()}),a.destroy(),n.success("Tokenåˆ·æ–°æˆåŠŸ")}catch(a){console.error("URLåˆ·æ–°Tokenå¤±è´¥:",a),n.error("åˆ·æ–°å¤±è´¥: "+a.message)}}})},y=()=>{try{const e=m.exportTokens(),s=JSON.stringify(e,null,2),a=new Blob([s],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,i.click(),n.success("Tokenæ•°æ®å·²å¯¼å‡º")}catch(e){n.error("å¯¼å‡ºå¤±è´¥: "+e.message)}},r=({file:e})=>{const s=new FileReader;s.onload=a=>{try{const i=JSON.parse(a.target.result),k=m.importTokens(i);k.success?(n.success(k.message),A.fetchGameRoles()):n.error(k.message)}catch{n.error("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯")}},s.readAsText(e.file)},F=()=>{l.info({title:"æ¸…ç†è¿‡æœŸToken",content:"ç¡®å®šè¦æ¸…ç†è¶…è¿‡24å°æ—¶æœªä½¿ç”¨çš„Tokenå—ï¼Ÿ",positiveText:"ç¡®å®š",negativeText:"å–æ¶ˆ",onPositiveClick:()=>{const e=m.cleanExpiredTokens();n.success(`å·²æ¸…ç† ${e} ä¸ªè¿‡æœŸToken`)}})},o=()=>{l.error({title:"æ¸…é™¤æ‰€æœ‰Token",content:"ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ¸¸æˆTokenå—ï¼Ÿè¿™å°†æ–­å¼€æ‰€æœ‰WebSocketè¿žæŽ¥ã€‚æ­¤æ“ä½œä¸å¯æ¢å¤ï¼",positiveText:"ç¡®å®šæ¸…é™¤",negativeText:"å–æ¶ˆ",onPositiveClick:()=>{m.clearAllGameTokens(),n.success("æ‰€æœ‰æ¸¸æˆTokenå·²æ¸…é™¤")}})};return(e,s)=>{const a=R("n-button"),i=R("n-upload"),k=R("n-dropdown"),d=R("n-tag");return J(),N("div",be,[t("div",Ue,[s[3]||(s[3]=t("h3",null,"Tokenç®¡ç†å™¨",-1)),t("div",$e,[c(a,{size:"small",onClick:f},{icon:g(()=>[c(O(G),null,{default:g(()=>[c(O(Y))]),_:1})]),default:g(()=>[s[0]||(s[0]=U(" åˆ·æ–° ",-1))]),_:1}),c(a,{size:"small",type:"warning",onClick:y},{icon:g(()=>[c(O(G),null,{default:g(()=>[c(O(Se))]),_:1})]),default:g(()=>[s[1]||(s[1]=U(" å¯¼å‡º ",-1))]),_:1}),c(i,{"show-file-list":!1,accept:".json",onChange:r},{default:g(()=>[c(a,{size:"small",type:"info"},{icon:g(()=>[c(O(G),null,{default:g(()=>[c(O(le))]),_:1})]),default:g(()=>[s[2]||(s[2]=U(" å¯¼å…¥ ",-1))]),_:1})]),_:1})])]),t("div",xe,[s[7]||(s[7]=t("h4",null,"ç”¨æˆ·è®¤è¯Token",-1)),O(m).userToken?(J(),N("div",Ce,[t("div",Oe,[s[4]||(s[4]=t("span",{class:"token-label"},"Token:",-1)),t("span",Re,W(h(O(m).userToken)),1)]),c(a,{size:"tiny",type:"error",onClick:S},{default:g(()=>[...s[5]||(s[5]=[U(" æ¸…é™¤ ",-1)])]),_:1})])):(J(),N("div",Ae,[...s[6]||(s[6]=[t("span",null,"æœªè®¾ç½®ç”¨æˆ·Token",-1)])]))]),t("div",We,[t("h4",null,"æ¸¸æˆè§’è‰²Token ("+W(Object.keys(O(m).gameTokens).length)+"ä¸ª)",1),t("div",Ee,[(J(!0),N(oe,null,ne(O(m).gameTokens,(b,C)=>(J(),N("div",{key:C,class:"game-token-item"},[t("div",Pe,[t("div",Ge,[t("span",Ne,W(b.roleName),1),t("span",Je,W(b.server),1)]),t("div",Le,[c(a,{size:"tiny",type:T(C)==="connected"?"success":"default",onClick:w=>$(C,b)},{default:g(()=>[U(W(T(C)==="connected"?"æ–­å¼€WS":"è¿žæŽ¥WS"),1)]),_:2},1032,["type","onClick"]),c(k,{options:p(b),trigger:"click",onSelect:w=>u(w,C,b)},{default:g(()=>[c(a,{size:"tiny",type:"tertiary"},{icon:g(()=>[c(O(G),null,{default:g(()=>[c(O(ce))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])])]),t("div",Me,[t("div",De,[s[8]||(s[8]=t("span",{class:"detail-label"},"Token:",-1)),t("span",je,W(h(b.token)),1)]),t("div",ze,[s[9]||(s[9]=t("span",{class:"detail-label"},"WebSocket URL:",-1)),t("span",Be,W(b.wsUrl),1)]),t("div",Fe,[s[10]||(s[10]=t("span",{class:"detail-label"},"åˆ›å»ºæ—¶é—´:",-1)),t("span",Ve,W(_(b.createdAt)),1)]),t("div",He,[s[11]||(s[11]=t("span",{class:"detail-label"},"æœ€åŽä½¿ç”¨:",-1)),t("span",Ie,W(_(b.lastUsed)),1)]),t("div",qe,[s[12]||(s[12]=t("span",{class:"detail-label"},"è¿žæŽ¥çŠ¶æ€:",-1)),c(d,{size:"small",type:x(T(C))},{default:g(()=>[U(W(L(T(C))),1)]),_:2},1032,["type"])])])]))),128))])]),t("div",Ke,[c(a,{type:"warning",onClick:F},{default:g(()=>[...s[13]||(s[13]=[U(" æ¸…ç†è¿‡æœŸToken ",-1)])]),_:1}),c(a,{type:"error",onClick:o},{default:g(()=>[...s[14]||(s[14]=[U(" æ¸…é™¤æ‰€æœ‰Token ",-1)])]),_:1})])])}}},Xe=se(Qe,[["__scopeId","data-v-aeb19e7e"]]),Ye={class:"profile-page"},Ze={class:"container"},et={class:"profile-content"},tt={class:"profile-section"},st={class:"info-card"},ot={class:"avatar-section"},nt={class:"info-form"},rt={class:"form-actions"},at={class:"profile-section"},lt={class:"info-card"},ct={class:"form-actions"},it={class:"profile-section"},ut={class:"info-card"},dt={class:"preferences-grid"},mt={class:"preference-item"},gt={class:"preference-item"},vt={class:"preference-item"},ft={class:"preference-item"},kt={class:"form-actions"},pt={class:"profile-section"},wt={class:"profile-section"},Tt={class:"info-card"},ht={class:"security-items"},St={class:"security-item"},_t={class:"security-item"},yt={class:"security-item"},bt={class:"security-item danger"},Ut={__name:"Profile",setup(v){ae();const n=ee(),l=te(),m=_e(),A=P(null),h=I({username:"",email:"",nickname:"",phone:"",avatar:""}),_=I({currentPassword:"",newPassword:"",confirmPassword:""}),T=I({theme:"auto",language:"zh-CN",notifications:!0,autoExecute:!1}),x={currentPassword:[{required:!0,message:"è¯·è¾“å…¥å½“å‰å¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç é•¿åº¦ä¸èƒ½å°‘äºŽ6ä½",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç ",trigger:"blur"},{validator:(y,r)=>r===_.newPassword,message:"ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´",trigger:"blur"}]},L=[{label:"è·Ÿéšç³»ç»Ÿ",value:"auto"},{label:"æµ…è‰²ä¸»é¢˜",value:"light"},{label:"æ·±è‰²ä¸»é¢˜",value:"dark"}],p=[{label:"ç®€ä½“ä¸­æ–‡",value:"zh-CN"},{label:"English",value:"en-US"}],u=async()=>{try{n.success("ä¸ªäººä¿¡æ¯ä¿å­˜æˆåŠŸ")}catch{n.error("ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},f=async()=>{if(A.value)try{await A.value.validate(),n.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),Object.keys(_).forEach(y=>{_[y]=""})}catch{}},S=()=>{localStorage.setItem("userPreferences",JSON.stringify(T)),n.success("åå¥½è®¾ç½®ä¿å­˜æˆåŠŸ")},$=y=>{T.theme=y,localStorage.setItem("theme",y),y==="dark"?document.documentElement.setAttribute("data-theme","dark"):y==="light"?document.documentElement.removeAttribute("data-theme"):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.removeAttribute("data-theme")},M=()=>{n.info("å¤´åƒæ›´æ¢åŠŸèƒ½å¼€å‘ä¸­...")},D=()=>{n.info("ä¸¤æ­¥éªŒè¯è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...")},j=()=>{n.info("ç™»å½•åŽ†å²æŸ¥çœ‹åŠŸèƒ½å¼€å‘ä¸­...")},z=()=>{n.info("æ•°æ®å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...")},B=()=>{l.warning({title:"åˆ é™¤è´¦æˆ·",content:"æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦æˆ·å’Œæ‰€æœ‰æ•°æ®ï¼Œä¸”æ— æ³•æ¢å¤ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ",positiveText:"ç¡®å®šåˆ é™¤",negativeText:"å–æ¶ˆ",onPositiveClick:()=>{n.error("è´¦æˆ·åˆ é™¤åŠŸèƒ½æš‚æœªå¼€æ”¾")}})};return re(()=>{m.userInfo&&Object.assign(h,m.userInfo);const y=localStorage.getItem("userPreferences");if(y)try{Object.assign(T,JSON.parse(y))}catch(r){console.error("è§£æžç”¨æˆ·åå¥½å¤±è´¥:",r)}}),(y,r)=>{const F=R("n-avatar"),o=R("n-button"),e=R("n-input"),s=R("n-form-item"),a=R("n-form"),i=R("n-select"),k=R("n-switch");return J(),N("div",Ye,[t("div",Ze,[r[32]||(r[32]=t("div",{class:"page-header"},[t("h1",null,"ä¸ªäººèµ„æ–™"),t("p",null,"ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œåå¥½è®¾ç½®")],-1)),t("div",et,[t("div",tt,[r[13]||(r[13]=t("h2",null,"åŸºæœ¬ä¿¡æ¯",-1)),t("div",st,[t("div",ot,[c(F,{size:"large",src:h.avatar,"fallback-src":"/icons/xiaoyugan.png"},null,8,["src"]),c(o,{size:"small",onClick:M},{default:g(()=>[...r[11]||(r[11]=[U(" æ›´æ¢å¤´åƒ ",-1)])]),_:1})]),t("div",nt,[c(a,{model:h,"label-placement":"left","label-width":"80px"},{default:g(()=>[c(s,{label:"ç”¨æˆ·å"},{default:g(()=>[c(e,{value:h.username,"onUpdate:value":r[0]||(r[0]=d=>h.username=d),readonly:""},null,8,["value"])]),_:1}),c(s,{label:"é‚®ç®±"},{default:g(()=>[c(e,{value:h.email,"onUpdate:value":r[1]||(r[1]=d=>h.email=d)},null,8,["value"])]),_:1}),c(s,{label:"æ˜µç§°"},{default:g(()=>[c(e,{value:h.nickname,"onUpdate:value":r[2]||(r[2]=d=>h.nickname=d),placeholder:"è¯·è¾“å…¥æ˜µç§°"},null,8,["value"])]),_:1}),c(s,{label:"æ‰‹æœº"},{default:g(()=>[c(e,{value:h.phone,"onUpdate:value":r[3]||(r[3]=d=>h.phone=d),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·"},null,8,["value"])]),_:1})]),_:1},8,["model"]),t("div",rt,[c(o,{type:"primary",onClick:u},{default:g(()=>[...r[12]||(r[12]=[U(" ä¿å­˜æ›´æ”¹ ",-1)])]),_:1})])])])]),t("div",at,[r[15]||(r[15]=t("h2",null,"å¯†ç ä¿®æ”¹",-1)),t("div",lt,[c(a,{ref_key:"passwordFormRef",ref:A,model:_,rules:x,"label-placement":"left","label-width":"100px"},{default:g(()=>[c(s,{label:"å½“å‰å¯†ç ",path:"currentPassword"},{default:g(()=>[c(e,{value:_.currentPassword,"onUpdate:value":r[4]||(r[4]=d=>_.currentPassword=d),type:"password",placeholder:"è¯·è¾“å…¥å½“å‰å¯†ç "},null,8,["value"])]),_:1}),c(s,{label:"æ–°å¯†ç ",path:"newPassword"},{default:g(()=>[c(e,{value:_.newPassword,"onUpdate:value":r[5]||(r[5]=d=>_.newPassword=d),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç "},null,8,["value"])]),_:1}),c(s,{label:"ç¡®è®¤æ–°å¯†ç ",path:"confirmPassword"},{default:g(()=>[c(e,{value:_.confirmPassword,"onUpdate:value":r[6]||(r[6]=d=>_.confirmPassword=d),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "},null,8,["value"])]),_:1})]),_:1},8,["model"]),t("div",ct,[c(o,{type:"primary",onClick:f},{default:g(()=>[...r[14]||(r[14]=[U(" ä¿®æ”¹å¯†ç  ",-1)])]),_:1})])])]),t("div",it,[r[21]||(r[21]=t("h2",null,"ç³»ç»Ÿåå¥½",-1)),t("div",ut,[t("div",dt,[t("div",mt,[r[16]||(r[16]=t("div",{class:"preference-label"},[t("h3",null,"ä¸»é¢˜è®¾ç½®"),t("p",null,"é€‰æ‹©æ‚¨å–œæ¬¢çš„ç•Œé¢ä¸»é¢˜")],-1)),c(i,{value:T.theme,"onUpdate:value":[r[7]||(r[7]=d=>T.theme=d),$],options:L},null,8,["value"])]),t("div",gt,[r[17]||(r[17]=t("div",{class:"preference-label"},[t("h3",null,"è¯­è¨€è®¾ç½®"),t("p",null,"é€‰æ‹©ç•Œé¢æ˜¾ç¤ºè¯­è¨€")],-1)),c(i,{value:T.language,"onUpdate:value":r[8]||(r[8]=d=>T.language=d),options:p},null,8,["value"])]),t("div",vt,[r[18]||(r[18]=t("div",{class:"preference-label"},[t("h3",null,"é€šçŸ¥è®¾ç½®"),t("p",null,"æŽ¥æ”¶ä»»åŠ¡å®Œæˆé€šçŸ¥")],-1)),c(k,{value:T.notifications,"onUpdate:value":r[9]||(r[9]=d=>T.notifications=d)},null,8,["value"])]),t("div",ft,[r[19]||(r[19]=t("div",{class:"preference-label"},[t("h3",null,"è‡ªåŠ¨æ‰§è¡Œ"),t("p",null,"é»˜è®¤å¼€å¯ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œ")],-1)),c(k,{value:T.autoExecute,"onUpdate:value":r[10]||(r[10]=d=>T.autoExecute=d)},null,8,["value"])])]),t("div",kt,[c(o,{type:"primary",onClick:S},{default:g(()=>[...r[20]||(r[20]=[U(" ä¿å­˜åå¥½ ",-1)])]),_:1})])])]),t("div",pt,[r[22]||(r[22]=t("h2",null,"Tokenç®¡ç†",-1)),c(Xe)]),t("div",wt,[r[31]||(r[31]=t("h2",null,"è´¦æˆ·å®‰å…¨",-1)),t("div",Tt,[t("div",ht,[t("div",St,[r[24]||(r[24]=t("div",{class:"security-info"},[t("h3",null,"ä¸¤æ­¥éªŒè¯"),t("p",null,"ä¸ºæ‚¨çš„è´¦æˆ·æ·»åŠ é¢å¤–çš„å®‰å…¨ä¿æŠ¤")],-1)),c(o,{onClick:D},{default:g(()=>[...r[23]||(r[23]=[U(" è®¾ç½® ",-1)])]),_:1})]),t("div",_t,[r[26]||(r[26]=t("div",{class:"security-info"},[t("h3",null,"ç™»å½•åŽ†å²"),t("p",null,"æŸ¥çœ‹æœ€è¿‘çš„ç™»å½•è®°å½•")],-1)),c(o,{onClick:j},{default:g(()=>[...r[25]||(r[25]=[U(" æŸ¥çœ‹ ",-1)])]),_:1})]),t("div",yt,[r[28]||(r[28]=t("div",{class:"security-info"},[t("h3",null,"æ•°æ®å¯¼å‡º"),t("p",null,"å¯¼å‡ºæ‚¨çš„æ‰€æœ‰æ•°æ®")],-1)),c(o,{onClick:z},{default:g(()=>[...r[27]||(r[27]=[U(" å¯¼å‡º ",-1)])]),_:1})]),t("div",bt,[r[30]||(r[30]=t("div",{class:"security-info"},[t("h3",null,"åˆ é™¤è´¦æˆ·"),t("p",null,"æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦æˆ·å’Œæ‰€æœ‰æ•°æ®")],-1)),c(o,{type:"error",onClick:B},{default:g(()=>[...r[29]||(r[29]=[U(" åˆ é™¤ ",-1)])]),_:1})])])])])])])])}}},At=se(Ut,[["__scopeId","data-v-a212a5e4"]]);export{At as default};
